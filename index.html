<!DOCTYPE html>

<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FinanciÃ«n â€” Rob Borghouts</title>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FinanciÃ«n RB">
<meta name="application-name" content="FinanciÃ«n RB">
<meta name="theme-color" content="#261e16">
<meta name="msapplication-TileColor" content="#261e16">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='bg2' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%231a1714'/%3E%3Cstop offset='1' stop-color='%232e2825'/%3E%3C/linearGradient%3E%3ClinearGradient id='stripe2' x1='0' y1='0' x2='1' y2='0'%3E%3Cstop offset='0' stop-color='%23c9602a'/%3E%3Cstop offset='0.4' stop-color='%23e8a060'/%3E%3Cstop offset='0.65' stop-color='%232a7a4f'/%3E%3Cstop offset='1' stop-color='%232a5b8a'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='112' fill='url(%23bg2)'/%3E%3Crect x='0' y='0' width='512' height='28' rx='14' fill='url(%23stripe2)'/%3E%3Ccircle cx='256' cy='290' r='140' fill='none' stroke='%23c9602a' stroke-width='12' opacity='0.5'/%3E%3Ccircle cx='256' cy='290' r='100' fill='none' stroke='%23c9602a' stroke-width='5' opacity='0.2'/%3E%3Ccircle cx='256' cy='290' r='60' fill='%23c9602a' opacity='0.08'/%3E%3Ctext x='256' y='335' font-family='Georgia,serif' font-size='120' font-weight='bold' fill='%23c9602a' text-anchor='middle' letter-spacing='-4'%3ERB%3C/text%3E%3Ctext x='256' y='110' font-family='Georgia,serif' font-size='42' fill='%236b6560' text-anchor='middle' letter-spacing='16'%3EFINANCI%C3%8BN%3C/text%3E%3C/svg%3E">
<link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22Financi%C3%ABn%20Rob%20Borghouts%22%2C%22short_name%22%3A%22Financi%C3%ABn%20RB%22%2C%22description%22%3A%22Persoonlijk%20financi%C3%ABl%20overzicht%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%231a1714%22%2C%22theme_color%22%3A%22%231a1714%22%2C%22orientation%22%3A%22portrait%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%253Csvg%2520xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%2520viewBox%3D'0%25200%2520512%2520512'%253E%253Crect%2520width%3D'512'%2520height%3D'512'%2520rx%3D'112'%2520fill%3D'%25231a1714'%2F%253E%253Ctext%2520x%3D'256'%2520y%3D'340'%2520font-family%3D'Georgia'%2520font-size%3D'120'%2520fill%3D'%2523c9602a'%2520text-anchor%3D'middle'%253ERB%253C%2Ftext%253E%253C%2Fsvg%253E%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%2C%22purpose%22%3A%22any%20maskable%22%7D%5D%7D">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%231a1714'/%3E%3Cstop offset='1' stop-color='%232e2825'/%3E%3C/linearGradient%3E%3ClinearGradient id='stripe' x1='0' y1='0' x2='1' y2='0'%3E%3Cstop offset='0' stop-color='%23c9602a'/%3E%3Cstop offset='0.4' stop-color='%23e8a060'/%3E%3Cstop offset='0.65' stop-color='%232a7a4f'/%3E%3Cstop offset='1' stop-color='%232a5b8a'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='22' fill='url(%23bg)'/%3E%3Crect x='0' y='0' width='100' height='5' rx='3' fill='url(%23stripe)'/%3E%3Ccircle cx='50' cy='54' r='28' fill='none' stroke='%23c9602a' stroke-width='2.5' opacity='0.5'/%3E%3Ccircle cx='50' cy='54' r='21' fill='none' stroke='%23c9602a' stroke-width='1' opacity='0.25'/%3E%3Ctext x='50' y='62' font-family='Georgia,serif' font-size='22' font-weight='bold' fill='%23c9602a' text-anchor='middle' letter-spacing='-1'%3ERB%3C/text%3E%3Ctext x='50' y='22' font-family='Georgia,serif' font-size='9' fill='%236b6560' text-anchor='middle' letter-spacing='3'%3EFINANCI%C3%8BN%3C/text%3E%3C/svg%3E">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Space+Grotesk:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
â€“bg: #f7f3ee;
â€“surface: #fdfaf6;
â€“card: #f0ebe3;
â€“border: #e2d9cc;
â€“ink: #14100a;
â€“ink2: #2e2416;
â€“muted: #6b5f52;
â€“accent: #b85c28;
â€“accent-light: #f5e8de;
â€“green: #1e6038;
â€“green-light: #dff0e8;
â€“blue: #1e4a72;
â€“blue-light: #deeaf5;
â€“red: #9e2018;
â€“red-light: #fce8e7;
â€“gold: #8a6820;
â€“gold-light: #f5edda;
â€“shadow: 0 2px 20px rgba(20,16,10,0.09);
â€“shadow-lg: 0 8px 40px rgba(20,16,10,0.16);
}

body {
font-family: â€˜Space Groteskâ€™, sans-serif;
background: var(â€“bg);
color: var(â€“ink);
min-height: 100vh;
overflow-x: hidden;
font-weight: 500;
-webkit-font-smoothing: antialiased;
}

.top-stripe {
height: 5px;
background: linear-gradient(90deg, #b85c28 0%, #d4924a 30%, #b08a3a 55%, #2d7a50 75%, #2e5f8a 100%);
}

/* â”€â”€ SIDEBAR LAYOUT â”€â”€ */
.layout {
display: grid;
grid-template-columns: 260px minmax(0, 1fr);
min-height: calc(100vh - 5px);
}

/* Sidebar */
.sidebar {
background: #261e16;
color: #f0ebe3;
padding: 2.5rem 1.8rem;
display: flex;
flex-direction: column;
gap: 0;
position: sticky;
top: 0;
height: calc(100vh - 5px);
overflow-y: auto;
}

.sidebar-logo {
display: flex;
align-items: center;
gap: 0.8rem;
margin-bottom: 2.5rem;
}

.logo-icon {
width: 44px;
height: 44px;
background: var(â€“accent);
border-radius: 12px;
display: flex;
align-items: center;
justify-content: center;
font-size: 1.3rem;
flex-shrink: 0;
}

.logo-text {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.3rem;
font-weight: 400;
line-height: 1.1;
}

.logo-text small {
display: block;
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.58rem;
text-transform: uppercase;
letter-spacing: 0.14em;
color: #7a6e62;
font-weight: 500;
margin-top: 1px;
}

.sidebar-nav {
display: flex;
flex-direction: column;
gap: 0.3rem;
margin-bottom: 2rem;
}

.nav-label {
font-size: 0.58rem;
text-transform: uppercase;
letter-spacing: 0.14em;
color: #4e453c;
font-weight: 600;
padding: 0.3rem 0.5rem;
margin-bottom: 0.2rem;
margin-top: 0.5rem;
}

.nav-item {
display: flex;
align-items: center;
gap: 0.7rem;
padding: 0.65rem 0.8rem;
border-radius: 10px;
cursor: pointer;
font-size: 0.86rem;
font-weight: 600;
color: #7a6e62;
transition: all 0.18s;
border: none;
background: none;
text-align: left;
width: 100%;
}

.nav-item:hover { background: rgba(255,255,255,0.07); color: #f7f3ee; }
.nav-item.active { background: rgba(201,96,42,0.18); color: var(â€“accent); }
.nav-item .nav-icon { font-size: 1rem; flex-shrink: 0; }

/* Sidebar balance block */
.sidebar-balance {
background: rgba(255,255,255,0.05);
border-radius: 14px;
padding: 1.2rem;
margin-top: auto;
border: 1px solid rgba(255,255,255,0.07);
}

.sidebar-balance .bal-label {
font-size: 0.6rem;
text-transform: uppercase;
letter-spacing: 0.12em;
color: #7a6e62;
font-weight: 500;
margin-bottom: 0.4rem;
}

.sidebar-balance .bal-amount {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 2rem;
font-weight: 600;
line-height: 1;
color: #f7f3ee;
}

.sidebar-balance .bal-amount.positive { color: #5dba88; }
.sidebar-balance .bal-amount.negative { color: #e85050; }

.sidebar-balance .bal-sub {
font-size: 0.62rem;
color: #4e453c;
margin-top: 0.35rem;
}

.made-by-sidebar {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 0.8rem;
font-style: italic;
color: #45392e;
margin-top: 1.2rem;
text-align: center;
}

.made-by-sidebar strong { color: #7a6e62; font-style: normal; }

/* Sidebar user */
.sidebar-user {
display: flex;
align-items: center;
gap: 0.6rem;
margin-top: 1rem;
padding: 0.7rem 0.8rem;
background: rgba(255,255,255,0.05);
border-radius: 10px;
border: 1px solid rgba(255,255,255,0.06);
}

.sb-user-avatar {
width: 32px; height: 32px;
border-radius: 50%;
object-fit: cover;
flex-shrink: 0;
background: #3a2a1a;
}

.sb-user-info { flex: 1; min-width: 0; }
.sb-user-name  { font-size: 0.78rem; font-weight: 700; color: #d0c8be; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sb-user-email { font-size: 0.6rem; color: #6b5f52; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.sb-logout-btn {
background: none; border: none;
color: #6b5f52; font-size: 1rem;
cursor: pointer; padding: 0.2rem;
border-radius: 5px; transition: color 0.15s;
flex-shrink: 0;
}
.sb-logout-btn:hover { color: #e87a60; }

.install-btn {
width: 100%;
background: var(â€“accent);
color: #f7f3ee;
border: none;
border-radius: 10px;
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.75rem;
font-weight: 600;
padding: 0.65rem 1rem;
cursor: pointer;
letter-spacing: 0.05em;
margin-top: 0.8rem;
transition: opacity 0.2s;
text-align: center;
}

.install-btn:hover { opacity: 0.85; }

/* â”€â”€ MAIN CONTENT â”€â”€ */
.main {
padding: 2.5rem 2.5rem 5rem;
overflow-y: auto;
overflow-x: hidden;
min-width: 0;
}

/* Page sections */
.page-section { display: none; }
.page-section.active { display: block; }

/* Page header */
.page-header {
margin-bottom: 2.5rem;
border-bottom: 1px solid var(â€“border);
padding-bottom: 1.5rem;
}

.page-header h2 {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: clamp(2rem, 4vw, 3rem);
font-weight: 300;
letter-spacing: -0.02em;
line-height: 1;
}

.page-header h2 em { font-style: italic; color: var(â€“accent); }

.page-header .page-date {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 0.9rem;
color: var(â€“muted);
font-style: italic;
margin-top: 0.4rem;
}

/* Summary grid */
.summary {
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 1rem;
margin-bottom: 2rem;
animation: riseUp 0.6s ease both;
}
.summary-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 14px;
padding: 1.3rem;
box-shadow: var(â€“shadow);
position: relative;
overflow: hidden;
transition: transform 0.2s, box-shadow 0.2s;
}

.summary-card:hover { transform: translateY(-2px); box-shadow: var(â€“shadow-lg); }

.summary-card::after {
content: â€˜â€™;
position: absolute;
top: 0; left: 0; right: 0;
height: 3px;
border-radius: 14px 14px 0 0;
}

.summary-card.sc-income::after  { background: var(â€“green); }
.summary-card.sc-expense::after { background: var(â€“accent); }
.summary-card.sc-balance::after { background: var(â€“blue); }
.summary-card.sc-avg::after     { background: #9a6faf; }

.sc-label {
font-size: 0.68rem;
text-transform: uppercase;
letter-spacing: 0.12em;
color: var(â€“muted);
font-weight: 600;
margin-bottom: 0.5rem;
}

.sc-num {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 2rem;
font-weight: 600;
line-height: 1;
}

.summary-card.sc-income  .sc-num { color: var(â€“green); }
.summary-card.sc-expense .sc-num { color: var(â€“accent); }
.summary-card.sc-balance .sc-num { color: var(â€“blue); }
.summary-card.sc-avg     .sc-num { color: #9a6faf; }
.sc-num.negative { color: var(â€“red) !important; }

.sc-sub {
font-size: 0.7rem;
color: var(â€“ink2);
margin-top: 0.35rem;
font-weight: 500;
}

/* Budget */
.budget-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 14px;
padding: 1.3rem 1.5rem;
margin-bottom: 1.5rem;
box-shadow: var(â€“shadow);
animation: riseUp 0.6s 0.07s ease both;
}

.budget-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 0.9rem;
}

.budget-header .b-label {
font-size: 0.65rem;
text-transform: uppercase;
letter-spacing: 0.12em;
color: var(â€“muted);
font-weight: 500;
}

.budget-header .b-right {
display: flex;
align-items: center;
gap: 0.4rem;
font-size: 0.72rem;
color: var(â€“muted);
}

.b-input {
width: 85px;
background: var(â€“card);
border: 1px solid var(â€“border);
border-radius: 7px;
color: var(â€“ink);
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.8rem;
padding: 0.32rem 0.55rem;
outline: none;
transition: border-color 0.2s;
text-align: right;
}

.b-input:focus { border-color: var(â€“accent); }

.budget-track {
background: var(â€“card);
border-radius: 99px;
height: 8px;
overflow: hidden;
}

.budget-fill {
height: 100%;
border-radius: 99px;
background: linear-gradient(90deg, var(â€“green), #5dba88);
transition: width 0.7s cubic-bezier(.16,1,.3,1), background 0.4s;
min-width: 0;
}

.budget-fill.warn { background: linear-gradient(90deg, #c9862a, #e8b060); }
.budget-fill.over { background: linear-gradient(90deg, var(â€“red), #e85050); }

.budget-labels {
display: flex;
justify-content: space-between;
margin-top: 0.45rem;
font-size: 0.67rem;
color: var(â€“muted);
}

/* Chart */
.chart-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 14px;
padding: 1.5rem;
margin-bottom: 1.5rem;
box-shadow: var(â€“shadow);
animation: riseUp 0.6s 0.12s ease both;
}

.chart-card .chart-title {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.3rem;
margin-bottom: 1.2rem;
}

.chart-card .chart-title em { font-style: italic; color: var(â€“accent); }

.chart-bars {
display: flex;
align-items: flex-end;
gap: 0.5rem;
height: 110px;
}

.chart-col {
flex: 1;
display: flex;
flex-direction: column;
align-items: center;
gap: 0.3rem;
height: 100%;
justify-content: flex-end;
}

.chart-bar-pair {
width: 100%;
display: flex;
gap: 2px;
align-items: flex-end;
}

.bar {
flex: 1;
border-radius: 5px 5px 0 0;
min-height: 3px;
transition: height 0.7s cubic-bezier(.16,1,.3,1);
cursor: default;
}

.bar.inc { background: var(â€“green-light); border: 1px solid #b0d8be; }
.bar.inc:hover { background: var(â€“green); }
.bar.exp { background: var(â€“accent-light); border: 1px solid #e8c4ae; }
.bar.exp:hover { background: var(â€“accent); }

.chart-lbl {
font-size: 0.58rem;
color: var(â€“muted);
text-transform: uppercase;
letter-spacing: 0.04em;
white-space: nowrap;
}

.chart-legend {
display: flex;
gap: 1rem;
margin-top: 0.8rem;
font-size: 0.65rem;
color: var(â€“muted);
}

.legend-dot {
width: 9px; height: 9px;
border-radius: 50%;
display: inline-block;
margin-right: 0.3rem;
vertical-align: middle;
}

/* Tip */
.tip-box {
background: linear-gradient(135deg, var(â€“accent-light) 0%, var(â€“bg) 100%);
border: 1px solid var(â€“border);
border-left: 3px solid var(â€“accent);
border-radius: 12px;
padding: 0.9rem 1.2rem;
margin-bottom: 1.5rem;
font-size: 0.78rem;
color: var(â€“ink2);
animation: riseUp 0.6s 0.17s ease both;
display: flex;
gap: 0.7rem;
align-items: flex-start;
line-height: 1.55;
}

.tip-box em { font-style: italic; font-weight: 500; color: var(â€“accent); }

/* Form card */
.form-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 16px;
padding: 1.8rem;
margin-bottom: 1.5rem;
box-shadow: var(â€“shadow);
animation: riseUp 0.6s 0.2s ease both;
}

.form-card .form-title {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.35rem;
font-weight: 400;
margin-bottom: 1.2rem;
}

.form-card .form-title em { font-style: italic; color: var(â€“accent); }
.form-card .form-title.income-title em { color: var(â€“green); }

/* Tab toggle */
.type-toggle {
display: flex;
gap: 0.5rem;
margin-bottom: 1.2rem;
}

.type-btn {
flex: 1;
padding: 0.6rem;
border-radius: 10px;
border: 1.5px solid var(â€“border);
background: var(â€“card);
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.78rem;
font-weight: 600;
letter-spacing: 0.04em;
text-transform: uppercase;
cursor: pointer;
transition: all 0.18s;
color: var(â€“muted);
}

.type-btn.active-expense { background: var(â€“accent); border-color: var(â€“accent); color: #fff; }
.type-btn.active-income  { background: var(â€“green);  border-color: var(â€“green);  color: #fff; }

.form-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 0.9rem;
}

.form-group { display: flex; flex-direction: column; gap: 0.35rem; }
.form-group.full { grid-column: 1 / -1; }

label {
font-size: 0.68rem;
text-transform: uppercase;
letter-spacing: 0.11em;
color: var(â€“ink2);
font-weight: 700;
}

input[type=text],
input[type=number],
input[type=date],
select,
textarea {
background: var(â€“card);
border: 1px solid var(â€“border);
border-radius: 9px;
color: var(â€“ink);
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.87rem;
padding: 0.72rem 0.95rem;
outline: none;
transition: border-color 0.2s, background 0.2s;
width: 100%;
-webkit-appearance: none;
resize: none;
}

input:focus, select:focus, textarea:focus {
border-color: var(â€“accent);
background: #fff;
}

.add-btn {
width: 100%;
border: none;
border-radius: 9px;
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.8rem;
font-weight: 600;
padding: 0.85rem;
cursor: pointer;
letter-spacing: 0.08em;
text-transform: uppercase;
margin-top: 1rem;
transition: opacity 0.2s, transform 0.1s;
}

.add-btn.btn-expense { background: var(â€“ink); color: #f7f3ee; }
.add-btn.btn-expense:hover { background: var(â€“accent); }
.add-btn.btn-income  { background: var(â€“green); color: #fff; }
.add-btn.btn-income:hover  { opacity: 0.85; }
.add-btn:active { transform: scale(0.99); }

/* Controls */
.controls {
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
gap: 0.8rem;
margin-bottom: 1rem;
animation: riseUp 0.6s 0.22s ease both;
}

.filter-row { display: flex; gap: 0.4rem; flex-wrap: wrap; }

.filter-btn {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 99px;
color: var(â€“ink2);
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.67rem;
font-weight: 500;
padding: 0.3rem 0.8rem;
cursor: pointer;
transition: all 0.16s;
text-transform: uppercase;
letter-spacing: 0.05em;
}

.filter-btn:hover { border-color: var(â€“accent); color: var(â€“accent); }
.filter-btn.active { background: var(â€“ink); border-color: var(â€“ink); color: #f7f3ee; }

.sort-select {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 8px;
color: var(â€“ink2);
font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.67rem;
font-weight: 500;
padding: 0.32rem 0.7rem;
cursor: pointer;
outline: none;
transition: border-color 0.2s;
width: auto;
}

.sort-select:focus { border-color: var(â€“accent); }

/* List */
.list-title {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.3rem;
font-weight: 400;
margin-bottom: 0.9rem;
animation: riseUp 0.6s 0.25s ease both;
}

.list-title em { font-style: italic; color: var(â€“accent); }

.transaction-list {
display: flex;
flex-direction: column;
gap: 0.6rem;
animation: riseUp 0.6s 0.27s ease both;
}

.tx-item {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 13px;
padding: 0.9rem 1.2rem;
display: grid;
grid-template-columns: 42px 1fr auto auto;
align-items: center;
gap: 0.9rem;
transition: box-shadow 0.2s, transform 0.18s;
}

.tx-item:hover { box-shadow: var(â€“shadow); transform: translateX(3px); }

.tx-item.is-income { border-left: 3px solid var(â€“green); }
.tx-item.is-expense { border-left: 3px solid var(â€“accent); }

.tx-icon {
width: 42px; height: 42px;
border-radius: 11px;
display: flex;
align-items: center;
justify-content: center;
font-size: 1.15rem;
flex-shrink: 0;
}

.tx-desc {
font-size: 0.98rem;
font-weight: 600;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
color: var(â€“ink);
}

.tx-meta {
font-size: 0.72rem;
color: var(â€“muted);
margin-top: 0.18rem;
text-transform: uppercase;
letter-spacing: 0.04em;
font-weight: 500;
}

.tx-amount {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.35rem;
font-weight: 700;
white-space: nowrap;
}

.tx-amount.income  { color: var(â€“green); }
.tx-amount.expense { color: var(â€“accent); }

.tx-delete {
background: none;
border: none;
color: var(â€“border);
cursor: pointer;
font-size: 0.82rem;
padding: 0.28rem;
border-radius: 6px;
transition: color 0.2s, background 0.2s;
line-height: 1;
}

.tx-delete:hover { color: var(â€“red); background: var(â€“red-light); }

/* Category icon backgrounds */
.cat-eten          { background: #fff4e3; }
.cat-transport     { background: #e3eef8; }
.cat-wonen         { background: #f0e8f8; }
.cat-gezondheid    { background: #e3f4ec; }
.cat-entertainment { background: #fde8e3; }
.cat-kleding       { background: #fce8f0; }
.cat-abonnement    { background: #e8f0e3; }
.cat-sporten       { background: #e3f8f4; }
.cat-overig        { background: #f0f0f0; }
.cat-salaris       { background: #e3f4ec; }
.cat-freelance     { background: #e8f4e3; }
.cat-gift          { background: #fce8f0; }
.cat-rente         { background: #e3ecf5; }
.cat-huur-inkomen  { background: #f0ece3; }
.cat-teruggave     { background: #f4f0e3; }
.cat-overig-ink    { background: #f0f0f0; }

/* Insights section */
.insights-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 1rem;
margin-bottom: 1.5rem;
animation: riseUp 0.6s 0.1s ease both;
}

.insight-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 14px;
padding: 1.3rem;
box-shadow: var(â€“shadow);
}

.insight-card h3 {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.15rem;
margin-bottom: 1rem;
}

.insight-card h3 em { font-style: italic; color: var(â€“accent); }

.cat-breakdown {
display: flex;
flex-direction: column;
gap: 0.6rem;
}

.cat-row {
display: flex;
align-items: center;
gap: 0.7rem;
}

.cat-row-icon { font-size: 1rem; width: 22px; text-align: center; }
.cat-row-label { font-size: 0.75rem; color: var(â€“ink2); flex: 1; }
.cat-row-bar-wrap { width: 80px; height: 5px; background: var(â€“card); border-radius: 99px; overflow: hidden; }
.cat-row-bar { height: 100%; border-radius: 99px; background: var(â€“accent); transition: width 0.6s cubic-bezier(.16,1,.3,1); }
.cat-row-amt { font-size: 0.75rem; font-weight: 500; color: var(â€“ink); white-space: nowrap; width: 60px; text-align: right; }

.savings-rate {
text-align: center;
padding: 1rem 0;
}

.savings-circle {
width: 110px;
height: 110px;
margin: 0 auto 0.8rem;
position: relative;
}

.savings-circle svg { transform: rotate(-90deg); }

.savings-circle .circle-bg { fill: none; stroke: var(â€“card); stroke-width: 8; }
.savings-circle .circle-val { fill: none; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 0.8s cubic-bezier(.16,1,.3,1); }

.savings-pct {
position: absolute;
inset: 0;
display: flex;
align-items: center;
justify-content: center;
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.6rem;
font-weight: 300;
}

.savings-label {
font-size: 0.65rem;
text-transform: uppercase;
letter-spacing: 0.1em;
color: var(â€“muted);
font-weight: 500;
}

.savings-sub {
font-size: 0.7rem;
color: var(â€“muted);
margin-top: 0.3rem;
}

/* Goals */
.goals-list {
display: flex;
flex-direction: column;
gap: 0.8rem;
animation: riseUp 0.6s 0.1s ease both;
}

.goal-item {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 13px;
padding: 1.1rem 1.3rem;
box-shadow: var(â€“shadow);
}

.goal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 0.7rem;
}

.goal-name { font-size: 0.9rem; font-weight: 500; }
.goal-amounts { font-size: 0.72rem; color: var(â€“muted); }

.goal-track {
background: var(â€“card);
border-radius: 99px;
height: 7px;
overflow: hidden;
}

.goal-fill {
height: 100%;
border-radius: 99px;
background: linear-gradient(90deg, var(â€“blue), #5d9fda);
transition: width 0.7s cubic-bezier(.16,1,.3,1);
}

.goal-fill.done { background: linear-gradient(90deg, var(â€“green), #5dba88); }

.goal-pct {
font-size: 0.62rem;
color: var(â€“muted);
margin-top: 0.35rem;
}

.goal-delete {
background: none;
border: none;
color: var(â€“border);
cursor: pointer;
font-size: 0.75rem;
transition: color 0.2s;
}

.goal-delete:hover { color: var(â€“red); }

/* Empty */
.empty-state {
text-align: center;
padding: 3.5rem 1rem;
color: var(â€“muted);
font-size: 0.78rem;
letter-spacing: 0.06em;
text-transform: uppercase;
}

.empty-state .icon { font-size: 2.8rem; display: block; margin-bottom: 0.8rem; opacity: 0.35; }

/* Toast */
.toast {
position: fixed;
bottom: 2rem;
right: 2rem;
background: var(â€“ink);
color: #f7f3ee;
font-size: 0.78rem;
font-weight: 500;
padding: 0.65rem 1.2rem;
border-radius: 10px;
box-shadow: var(â€“shadow-lg);
opacity: 0;
transform: translateY(8px);
transition: all 0.25s;
pointer-events: none;
z-index: 999;
}

.toast.show { opacity: 1; transform: translateY(0); }

/* App footer */
.app-footer {
text-align: center;
padding: 2.5rem 1rem 1rem;
margin-top: 2rem;
border-top: 1px solid var(â€“border);
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1rem;
font-style: italic;
color: var(â€“muted);
letter-spacing: 0.02em;
}

.app-footer strong {
font-weight: 600;
font-style: normal;
color: var(â€“ink);
}

/* Mobile menu toggle */
.mobile-header { display: none; }

/* â”€â”€ CATEGORIES MANAGEMENT â”€â”€ */
.cat-manage-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 1.2rem;
margin-top: 0.5rem;
}

.cat-manage-col h3 {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.2rem;
font-weight: 400;
margin-bottom: 0.9rem;
padding-bottom: 0.6rem;
border-bottom: 1px solid var(â€“border);
}

.cat-manage-col h3 em { font-style: italic; color: var(â€“accent); }
.cat-manage-col h3 em.green { color: var(â€“green); }

.cat-manage-list {
display: flex;
flex-direction: column;
gap: 0.5rem;
}

.cat-manage-item {
display: flex;
align-items: center;
gap: 0.7rem;
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 11px;
padding: 0.7rem 1rem;
transition: box-shadow 0.18s;
}

.cat-manage-item:hover { box-shadow: var(â€“shadow); }

.cat-manage-item.is-default {
opacity: 0.65;
}

.cat-manage-emoji {
font-size: 1.3rem;
width: 36px;
height: 36px;
display: flex;
align-items: center;
justify-content: center;
border-radius: 9px;
flex-shrink: 0;
}

.cat-manage-name {
font-size: 0.85rem;
font-weight: 500;
flex: 1;
color: var(â€“ink);
}

.cat-manage-badge {
font-size: 0.58rem;
text-transform: uppercase;
letter-spacing: 0.08em;
color: var(â€“muted);
font-weight: 500;
background: var(â€“card);
padding: 0.18rem 0.45rem;
border-radius: 99px;
border: 1px solid var(â€“border);
}

.cat-manage-del {
background: none;
border: none;
color: var(â€“border);
cursor: pointer;
font-size: 0.82rem;
padding: 0.28rem;
border-radius: 6px;
transition: color 0.18s, background 0.18s;
line-height: 1;
flex-shrink: 0;
}

.cat-manage-del:hover { color: var(â€“red); background: var(â€“red-light); }
.cat-manage-del:disabled { opacity: 0.25; cursor: not-allowed; }

.cat-manage-del:disabled:hover { color: var(â€“border); background: none; }

@keyframes riseUp {
from { opacity: 0; transform: translateY(16px); }
to   { opacity: 1; transform: translateY(0); }
}

/* Owner groups */
.owner-group {
margin-bottom: 1.8rem;
}

.owner-group-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 0.8rem;
padding-bottom: 0.6rem;
border-bottom: 1px solid var(â€“border);
}

.owner-group-name {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.3rem;
font-weight: 400;
color: var(â€“ink);
}

.owner-group-total {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 1.4rem;
font-weight: 300;
color: var(â€“green);
}

.owner-group-total.negative { color: var(â€“red); }

.owner-cards-row {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
gap: 1rem;
}

/* Account cards container â€” no longer a direct grid, groups handle that */
.account-cards {
margin-bottom: 1.5rem;
animation: riseUp 0.6s ease both;
}

@media (max-width: 700px) {
.owner-cards-row { grid-template-columns: 1fr 1fr; }
}

/* â”€â”€ CRYPTO â”€â”€ */
.crypto-total-card {
background: linear-gradient(135deg, #261e16 0%, #3a2a1a 100%);
border-radius: 20px;
padding: 2rem 2rem 1.5rem;
margin-bottom: 1.5rem;
color: #f0ebe3;
position: relative;
overflow: hidden;
animation: riseUp 0.5s ease both;
}

.crypto-total-card::before {
content: â€˜â‚¿â€™;
position: absolute;
right: 1.5rem;
top: 50%;
transform: translateY(-50%);
font-size: 6rem;
opacity: 0.06;
line-height: 1;
}

.crypto-total-label {
font-size: 0.65rem;
text-transform: uppercase;
letter-spacing: 0.14em;
color: #7a6e62;
font-weight: 600;
margin-bottom: 0.5rem;
}

.crypto-total-amount {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 3rem;
font-weight: 600;
line-height: 1;
color: #f0ebe3;
margin-bottom: 0.4rem;
}

.crypto-total-sub {
font-size: 0.72rem;
color: #7a6e62;
font-weight: 500;
}

.crypto-refresh-btn {
position: absolute;
top: 1.2rem;
right: 1.2rem;
background: rgba(255,255,255,0.08);
border: 1px solid rgba(255,255,255,0.12);
color: #9a8e82;
border-radius: 8px;
padding: 0.4rem 0.75rem;
font-size: 0.72rem;
font-weight: 600;
cursor: pointer;
font-family: â€˜Space Groteskâ€™, sans-serif;
transition: all 0.18s;
}

.crypto-refresh-btn:hover { background: rgba(255,255,255,0.14); color: #f0ebe3; }
.crypto-refresh-btn.spinning { animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.crypto-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
gap: 1rem;
animation: riseUp 0.5s 0.1s ease both;
}

.crypto-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 16px;
padding: 1.3rem;
box-shadow: var(â€“shadow);
position: relative;
overflow: hidden;
transition: transform 0.18s, box-shadow 0.18s;
}

.crypto-card:hover { transform: translateY(-2px); box-shadow: var(â€“shadow-lg); }

.crypto-card-top {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 0.9rem;
}

.crypto-coin-info { display: flex; align-items: center; gap: 0.7rem; }

.crypto-coin-icon {
width: 42px; height: 42px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 1rem;
font-weight: 700;
color: #fff;
flex-shrink: 0;
font-family: â€˜Space Groteskâ€™, sans-serif;
}

.crypto-coin-name  { font-size: 0.95rem; font-weight: 700; color: var(â€“ink); line-height: 1.2; }
.crypto-coin-symbol { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(â€“muted); font-weight: 600; }

.crypto-card-del {
background: none; border: none; color: var(â€“border); cursor: pointer;
font-size: 0.78rem; padding: 0.25rem; border-radius: 5px; transition: color 0.15s, background 0.15s;
}
.crypto-card-del:hover { color: var(â€“red); background: var(â€“red-light); }

.crypto-price-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.3rem; }

.crypto-price { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 1.5rem; font-weight: 600; color: var(â€“ink); }

.crypto-change { font-size: 0.72rem; font-weight: 700; padding: 0.2rem 0.5rem; border-radius: 6px; }
.crypto-change.up   { background: var(â€“green-light); color: var(â€“green); }
.crypto-change.down { background: var(â€“red-light);   color: var(â€“red); }
.crypto-change.flat { background: var(â€“card);         color: var(â€“muted); }

.crypto-holdings {
border-top: 1px solid var(â€“border);
margin-top: 0.9rem; padding-top: 0.9rem;
display: flex; justify-content: space-between; align-items: center; gap: 0.5rem;
}

.crypto-amount-input {
background: var(â€“card); border: 1px solid var(â€“border); border-radius: 8px;
padding: 0.35rem 0.6rem; font-family: â€˜Space Groteskâ€™, sans-serif;
font-size: 0.82rem; font-weight: 600; color: var(â€“ink);
width: 110px; outline: none; transition: border-color 0.15s;
}
.crypto-amount-input:focus { border-color: var(â€“accent); }

.crypto-eur-value { font-family: â€˜Cormorant Garamondâ€™, serif; font-size: 1.3rem; font-weight: 700; color: var(â€“green); text-align: right; }
.crypto-eur-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(â€“muted); font-weight: 600; text-align: right; }

.crypto-error {
background: var(â€“red-light); color: var(â€“red); border-radius: 10px;
padding: 0.8rem 1rem; font-size: 0.78rem; font-weight: 600; margin-bottom: 1rem;
}

@media (max-width: 700px) {
.crypto-grid { grid-template-columns: 1fr; }
.crypto-total-amount { font-size: 2.2rem; }
}
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 16px;
padding: 1.3rem;
box-shadow: var(â€“shadow);
position: relative;
overflow: hidden;
cursor: pointer;
transition: transform 0.18s, box-shadow 0.18s;
}

.account-card:hover { transform: translateY(-2px); box-shadow: var(â€“shadow-lg); }
.account-card.selected { border-width: 2px; }

.account-card::before {
content: â€˜â€™;
position: absolute;
top: 0; left: 0; right: 0;
height: 3px;
}

.account-card-top {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 0.8rem;
}

.account-card-icon {
font-size: 1.4rem;
width: 40px; height: 40px;
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
background: var(â€“card);
}

.account-card-del {
background: none;
border: none;
color: var(â€“border);
cursor: pointer;
font-size: 0.78rem;
padding: 0.25rem;
border-radius: 5px;
transition: color 0.18s, background 0.18s;
line-height: 1;
}

.account-card-del:hover { color: var(â€“red); background: var(â€“red-light); }

.account-card-name {
font-size: 0.95rem;
font-weight: 700;
color: var(â€“ink);
margin-bottom: 0.2rem;
}

.account-card-type {
font-size: 0.65rem;
text-transform: uppercase;
letter-spacing: 0.1em;
color: var(â€“muted);
font-weight: 600;
}

.account-card-balance {
font-family: â€˜Cormorant Garamondâ€™, serif;
font-size: 2rem;
font-weight: 600;
line-height: 1;
margin-top: 0.7rem;
color: var(â€“ink);
}

.account-card-balance.negative { color: var(â€“red); }

.account-card-sub {
font-size: 0.63rem;
color: var(â€“muted);
margin-top: 0.3rem;
}

/* Color picker dots */
.color-picker {
display: flex;
gap: 0.45rem;
align-items: center;
padding: 0.72rem 0.5rem;
flex-wrap: wrap;
}

.color-dot {
width: 22px; height: 22px;
border-radius: 50%;
cursor: pointer;
border: 2px solid transparent;
transition: transform 0.15s, border-color 0.15s;
flex-shrink: 0;
}

.color-dot:hover { transform: scale(1.2); }
.color-dot.selected { border-color: var(â€“ink); transform: scale(1.15); }

/* Account badge on tx items */
.tx-account-badge {
display: inline-flex;
align-items: center;
gap: 0.25rem;
font-size: 0.6rem;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.06em;
padding: 0.15rem 0.45rem;
border-radius: 99px;
color: #fff;
margin-left: 0.35rem;
vertical-align: middle;
}

@media (max-width: 700px) {
.account-cards { grid-template-columns: 1fr 1fr; }
.cat-manage-grid { grid-template-columns: 1fr; }

/* Hide full sidebar on mobile */
.layout { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
.sidebar {
position: fixed;
bottom: 0; left: 0; right: 0;
top: auto;
height: auto;
flex-direction: row;
flex-wrap: nowrap;
padding: 0;
gap: 0;
z-index: 100;
border-top: 1px solid rgba(255,255,255,0.08);
box-shadow: 0 -4px 20px rgba(0,0,0,0.25);
overflow: visible;
}

/* Hide decorative sidebar elements on mobile */
.sidebar-logo    { display: none; }
.sidebar-balance { display: none; }
.made-by-sidebar { display: none; }
.install-btn     { display: none !important; }
.nav-label       { display: none; }

/* Nav items become bottom tab bar */
.sidebar-nav {
display: flex;
flex-direction: row;
width: 100%;
margin-bottom: 0;
gap: 0;
}

.nav-item {
flex: 1;
flex-direction: column;
align-items: center;
justify-content: center;
gap: 0.2rem;
padding: 0.6rem 0.3rem 0.75rem;
border-radius: 0;
font-size: 0.52rem;
letter-spacing: 0.04em;
text-transform: uppercase;
color: #60554c;
min-width: 0;
}

.nav-item .nav-icon { font-size: 1.3rem; }
.nav-item:hover { background: rgba(255,255,255,0.05); color: #f7f3ee; }
.nav-item.active { background: transparent; color: var(â€“accent); }
.nav-item.active .nav-icon { filter: drop-shadow(0 0 4px rgba(201,96,42,0.5)); }

/* Main content sits above bottom nav */
.main {
padding: 1.2rem 1rem 5.5rem;
min-height: 100vh;
}

/* Page header smaller on mobile */
.page-header { margin-bottom: 1.5rem; padding-bottom: 1rem; }
.page-header h2 { font-size: 2rem; }

/* Summary 2-col grid */
.summary { grid-template-columns: 1fr 1fr; gap: 0.7rem; margin-bottom: 1.2rem; }
.summary-card { padding: 1rem; }
.sc-num { font-size: 1.4rem; }

/* Forms */
.form-grid { grid-template-columns: 1fr; }
.form-card { padding: 1.3rem; }

/* Insights */
.insights-grid { grid-template-columns: 1fr; }

/* Transaction items */
.tx-item { grid-template-columns: 38px 1fr auto auto; gap: 0.6rem; padding: 0.8rem 0.9rem; }

/* Controls */
.controls { flex-direction: column; align-items: flex-start; }

/* Footer */
.app-footer { padding-bottom: 2rem; font-size: 0.88rem; }
}
</style>

</head>
<body>
<!-- â”€â”€ LOGIN SCREEN â”€â”€ -->
<div id="login-screen" style="display:flex; position:fixed; inset:0; z-index:9999; background:#f7f3ee; flex-direction:column; align-items:center; justify-content:center; padding:2rem;">
  <div style="text-align:center; max-width:340px; width:100%;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" width="80" height="80" style="display:block;margin:0 auto 1.5rem">
      <rect width="80" height="80" rx="18" fill="#261e16"/>
      <rect x="0" y="0" width="80" height="5" rx="3" fill="url(#lsg)"/>
      <defs><linearGradient id="lsg" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0" stop-color="#c9602a"/>
        <stop offset="0.5" stop-color="#e8a060"/>
        <stop offset="1" stop-color="#2a5b8a"/>
      </linearGradient></defs>
      <circle cx="40" cy="46" r="22" fill="none" stroke="#c9602a" stroke-width="2" opacity="0.6"/>
      <text x="40" y="53" font-family="Georgia,serif" font-size="16" font-weight="bold" fill="#c9602a" text-anchor="middle">RB</text>
    </svg>
    <div style="font-family:'Cormorant Garamond',serif; font-size:2rem; font-weight:600; color:#14100a; margin-bottom:0.3rem;">FinanciÃ«n</div>
    <div style="font-size:0.78rem; color:#6b5f52; font-weight:500; margin-bottom:2.5rem;">Rob &amp; Lizet Â· Gedeeld huishoudboekje</div>

```
<button onclick="loginWithGoogle()" style="
  display:flex; align-items:center; gap:0.8rem; justify-content:center;
  width:100%; padding:0.9rem 1.5rem;
  background:#fff; border:2px solid #e2d9cc; border-radius:14px;
  font-family:'Space Grotesk',sans-serif; font-size:0.95rem; font-weight:600; color:#14100a;
  cursor:pointer; box-shadow:0 2px 12px rgba(0,0,0,0.08); transition:all 0.18s;
" onmouseover="this.style.borderColor='#b85c28'" onmouseout="this.style.borderColor='#e2d9cc'">
  <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
  Inloggen met Google
</button>

<div style="margin-top:1.5rem; font-size:0.68rem; color:#9a8e82; font-weight:500; line-height:1.6;">
  Alleen Rob en Lizet kunnen inloggen.<br>Data is gedeeld en beveiligd via Google.
</div>
```

  </div>
</div>

<div id="app-wrapper" style="display:none; grid-template-rows:auto 1fr; min-height:100vh;">
<div class="top-stripe"></div>
<div class="layout">

  <!-- â”€â”€ SIDEBAR â”€â”€ -->

  <nav class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon" style="background:none;padding:0;width:44px;height:44px;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44" style="display:block">
    <defs>
      <linearGradient id="ls" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0" stop-color="#c9602a"/>
        <stop offset="0.4" stop-color="#e8a060"/>
        <stop offset="0.65" stop-color="#2a7a4f"/>
        <stop offset="1" stop-color="#2a5b8a"/>
      </linearGradient>
    </defs>
    <rect width="44" height="44" rx="10" fill="#2a1e14"/>
    <rect x="0" y="0" width="44" height="3" rx="2" fill="url(#ls)"/>
    <circle cx="22" cy="26" r="13" fill="none" stroke="#c9602a" stroke-width="1.5" opacity="0.6"/>
    <circle cx="22" cy="26" r="9.5" fill="none" stroke="#c9602a" stroke-width="0.8" opacity="0.25"/>
    <text x="22" y="31" font-family="Georgia,serif" font-size="10" font-weight="bold" fill="#c9602a" text-anchor="middle" letter-spacing="-0.5">RB</text>
    <text x="22" y="11" font-family="Georgia,serif" font-size="3.8" fill="#7a6e62" text-anchor="middle" letter-spacing="1.8">FIN</text>
  </svg>
</div>
      <div class="logo-text">
        FinanciÃ«n
        <small>Rob Borghouts</small>
      </div>
    </div>

```
<div class="sidebar-nav">
  <div class="nav-label">Menu</div>
  <button class="nav-item active" onclick="showPage('dashboard')">
    <span class="nav-icon">ğŸ“Š</span> Dashboard
  </button>
  <button class="nav-item" onclick="showPage('transactions')">
    <span class="nav-icon">â†•ï¸</span> Transacties
  </button>
  <button class="nav-item" onclick="showPage('insights')">
    <span class="nav-icon">ğŸ“ˆ</span> Inzichten
  </button>
  <button class="nav-item" onclick="showPage('goals')">
    <span class="nav-icon">ğŸ¯</span> Doelen
  </button>
  <button class="nav-item" onclick="showPage('categories')">
    <span class="nav-icon">ğŸ·ï¸</span> CategorieÃ«n
  </button>
  <button class="nav-item" onclick="showPage('accounts')">
    <span class="nav-icon">ğŸ¦</span> Rekeningen
  </button>
  <button class="nav-item" onclick="showPage('crypto')">
    <span class="nav-icon">â‚¿</span> Crypto
  </button>
</div>

<div class="sidebar-balance">
  <div class="bal-label">Netto saldo (deze maand)</div>
  <div class="bal-amount" id="sb-balance">â‚¬ 0</div>
  <div class="bal-sub" id="sb-balance-sub">Inkomsten - Uitgaven</div>
</div>

<div class="made-by-sidebar">Made by <strong>Rob Borghouts</strong> 2026</div>
<button class="install-btn" id="install-btn" onclick="installApp()" style="display:none">
  ğŸ“² Installeer app
</button>

<!-- User info + logout -->
<div class="sidebar-user" id="sidebar-user">
  <img class="sb-user-avatar" id="sb-user-avatar" src="" alt="" />
  <div class="sb-user-info">
    <div class="sb-user-name" id="sb-user-name">â€”</div>
    <div class="sb-user-email" id="sb-user-email"></div>
  </div>
  <button class="sb-logout-btn" onclick="logoutUser()" title="Uitloggen">â»</button>
</div>
```

  </nav>

  <!-- â”€â”€ MAIN â”€â”€ -->

  <main class="main">

```
<!-- â”€â”€ DASHBOARD â”€â”€ -->
<section class="page-section active" id="page-dashboard">
  <div class="page-header">
    <h2>Goedemorgen, <em id="greeting-name">Rob</em> ğŸ‘‹</h2>
    <div class="page-date" id="header-date"></div>
  </div>

  <div class="summary">
    <div class="summary-card sc-income">
      <div class="sc-label">Inkomsten (maand)</div>
      <div class="sc-num" id="sc-income">â‚¬ 0</div>
      <div class="sc-sub" id="sc-income-sub">0 transacties</div>
    </div>
    <div class="summary-card sc-expense">
      <div class="sc-label">Uitgaven (maand)</div>
      <div class="sc-num" id="sc-expense">â‚¬ 0</div>
      <div class="sc-sub" id="sc-expense-sub">0 transacties</div>
    </div>
    <div class="summary-card sc-balance">
      <div class="sc-label">Netto saldo</div>
      <div class="sc-num" id="sc-balance">â‚¬ 0</div>
      <div class="sc-sub">inkomen âˆ’ uitgaven</div>
    </div>
    <div class="summary-card sc-avg">
      <div class="sc-label">Gem. uitgave/dag</div>
      <div class="sc-num" id="sc-avg">â‚¬ 0</div>
      <div class="sc-sub">gebaseerd op deze maand</div>
    </div>
  </div>

  <div class="budget-card">
    <div class="budget-header">
      <div class="b-label">Maandbudget (uitgaven)</div>
      <div class="b-right">
        â‚¬ <input class="b-input" type="number" id="budget-input" placeholder="2000" min="0" step="50" oninput="updateBudget()" />
      </div>
    </div>
    <div class="budget-track">
      <div class="budget-fill" id="budget-fill" style="width:0%"></div>
    </div>
    <div class="budget-labels">
      <span id="budget-spent">â‚¬ 0,00 uitgegeven</span>
      <span id="budget-left">Stel budget in â†’</span>
    </div>
  </div>

  <div class="chart-card">
    <div class="chart-title">Inkomsten <em>vs</em> Uitgaven â€” 6 maanden</div>
    <div class="chart-bars" id="chart-bars"></div>
    <div class="chart-legend">
      <span><span class="legend-dot" style="background:var(--green)"></span>Inkomsten</span>
      <span><span class="legend-dot" style="background:var(--accent)"></span>Uitgaven</span>
    </div>
  </div>

  <div class="tip-box">
    <span style="font-size:1rem;flex-shrink:0;margin-top:1px">ğŸ’¡</span>
    <div id="tip-text"></div>
  </div>

  <!-- Add transaction form -->
  <div class="form-card">
    <div class="form-title">Nieuwe <em>transactie</em></div>
    <div class="type-toggle">
      <button class="type-btn active-expense" id="btn-expense" onclick="setType('expense')">âˆ’ Uitgave</button>
      <button class="type-btn" id="btn-income"  onclick="setType('income')">+ Inkomst</button>
    </div>
    <div class="form-grid">
      <div class="form-group full">
        <label>Omschrijving</label>
        <input type="text" id="desc" placeholder="Bijv. Salaris aprilâ€¦" />
      </div>
      <div class="form-group">
        <label>Bedrag (â‚¬)</label>
        <input type="number" id="amount" placeholder="0,00" step="0.01" min="0" />
      </div>
      <div class="form-group">
        <label>Categorie</label>
        <select id="category"></select>
      </div>
      <div class="form-group">
        <label>Datum</label>
        <input type="date" id="date" />
      </div>
      <div class="form-group full">
        <label>Rekening / Kas</label>
        <select id="account-select"></select>
      </div>
      <div class="form-group full">
        <label>Notitie (optioneel)</label>
        <input type="text" id="note" placeholder="Extra toelichtingâ€¦" />
      </div>
    </div>
    <button class="add-btn btn-expense" id="add-btn" onclick="addTransaction()">ï¼‹ &nbsp;Transactie toevoegen</button>
  </div>

  <!-- Recent -->
  <div class="list-title">Recente <em>transacties</em></div>
  <div class="transaction-list" id="recent-list"></div>
</section>

<!-- â”€â”€ GLOBAL FOOTER â”€â”€ -->
<footer class="app-footer">
  Made by <strong>Rob Borghouts</strong> Â· 2026
</footer>

<!-- â”€â”€ TRANSACTIES â”€â”€ -->
<section class="page-section" id="page-transactions">
  <div class="page-header">
    <h2>Alle <em>Transacties</em></h2>
    <div class="page-date">Volledig overzicht van inkomsten & uitgaven</div>
  </div>

  <div class="controls">
    <div class="filter-row" id="filter-row"></div>
    <select class="sort-select" id="sort-select" onchange="renderTransactions()">
      <option value="date-desc">Nieuwste eerst</option>
      <option value="date-asc">Oudste eerst</option>
      <option value="amount-desc">Hoogste bedrag</option>
      <option value="amount-asc">Laagste bedrag</option>
    </select>
  </div>

  <div class="transaction-list" id="all-list"></div>
</section>

<!-- â”€â”€ INZICHTEN â”€â”€ -->
<section class="page-section" id="page-insights">
  <div class="page-header">
    <h2>FinanciÃ«le <em>Inzichten</em></h2>
    <div class="page-date">Analyse van jouw geldstromen</div>
  </div>

  <div class="insights-grid">
    <div class="insight-card">
      <h3>Top uitgaven<em> categorieÃ«n</em></h3>
      <div class="cat-breakdown" id="cat-breakdown"></div>
    </div>
    <div class="insight-card" style="display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;">
      <h3 style="width:100%">Spaar<em>quote</em></h3>
      <div class="savings-circle">
        <svg viewBox="0 0 100 100" width="110" height="110">
          <circle class="circle-bg" cx="50" cy="50" r="40"/>
          <circle class="circle-val" id="circle-val" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="251.2"/>
        </svg>
        <div class="savings-pct" id="savings-pct">0%</div>
      </div>
      <div class="savings-label">van inkomsten gespaard</div>
      <div class="savings-sub" id="savings-sub">Voeg inkomsten toe om te berekenen</div>
    </div>
  </div>

  <div class="chart-card" style="animation: riseUp 0.6s 0.15s ease both">
    <div class="chart-title">Inkomsten <em>vs</em> Uitgaven â€” 6 maanden</div>
    <div class="chart-bars" id="chart-bars-2"></div>
    <div class="chart-legend">
      <span><span class="legend-dot" style="background:var(--green)"></span>Inkomsten</span>
      <span><span class="legend-dot" style="background:var(--accent)"></span>Uitgaven</span>
    </div>
  </div>
</section>

<!-- â”€â”€ DOELEN â”€â”€ -->
<section class="page-section" id="page-goals">
  <div class="page-header">
    <h2>Spaar<em>doelen</em></h2>
    <div class="page-date">Werk toe naar jouw financiÃ«le doelen</div>
  </div>

  <!-- Goal form -->
  <div class="form-card" style="animation: riseUp 0.6s ease both">
    <div class="form-title">Nieuw <em>spaardoel</em></div>
    <div class="form-grid">
      <div class="form-group full">
        <label>Naam van het doel</label>
        <input type="text" id="goal-name" placeholder="Bijv. Vakantie ItaliÃ« ğŸ‡®ğŸ‡¹" />
      </div>
      <div class="form-group">
        <label>Doelbedrag (â‚¬)</label>
        <input type="number" id="goal-target" placeholder="2500" min="0" step="50" />
      </div>
      <div class="form-group">
        <label>Al gespaard (â‚¬)</label>
        <input type="number" id="goal-saved" placeholder="0" min="0" step="10" />
      </div>
    </div>
    <button class="add-btn btn-expense" onclick="addGoal()">ğŸ¯ &nbsp;Doel toevoegen</button>
  </div>

  <div class="list-title">Mijn <em>doelen</em></div>
  <div class="goals-list" id="goals-list"></div>
</section>

<!-- â”€â”€ CATEGORIEÃ‹N â”€â”€ -->
<section class="page-section" id="page-categories">
  <div class="page-header">
    <h2>Mijn <em>CategorieÃ«n</em></h2>
    <div class="page-date">Voeg eigen categorieÃ«n toe of verwijder ze</div>
  </div>

  <!-- Add category form -->
  <div class="form-card" style="animation: riseUp 0.6s ease both">
    <div class="form-title">Nieuwe <em>categorie</em></div>

    <!-- Type toggle -->
    <div class="type-toggle" style="margin-bottom:1.2rem">
      <button class="type-btn active-expense" id="cat-btn-expense" onclick="setCatType('expense')">âˆ’ Uitgave</button>
      <button class="type-btn" id="cat-btn-income" onclick="setCatType('income')">+ Inkomst</button>
    </div>

    <div class="form-grid">
      <div class="form-group">
        <label>Naam categorie</label>
        <input type="text" id="cat-name" placeholder="Bijv. Huisdier" maxlength="30" />
      </div>
      <div class="form-group">
        <label>Emoji icoon</label>
        <input type="text" id="cat-icon-input" placeholder="Klik op emoji â†’" readonly style="cursor:pointer" onclick="toggleEmojiPicker()" />
      </div>
    </div>

    <!-- Emoji picker -->
    <div id="emoji-picker" style="display:none;margin-top:0.9rem">
      <div style="font-size:0.62rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);font-weight:500;margin-bottom:0.6rem">Kies een icoon</div>
      <div id="emoji-grid" style="display:flex;flex-wrap:wrap;gap:0.4rem;max-height:180px;overflow-y:auto;padding:0.5rem;background:var(--card);border-radius:10px;border:1px solid var(--border)"></div>
    </div>

    <button class="add-btn btn-expense" id="cat-add-btn" onclick="addCustomCategory()" style="margin-top:1rem">
      ğŸ·ï¸ &nbsp;Categorie toevoegen
    </button>
  </div>

  <!-- Existing categories -->
  <div class="cat-manage-grid" id="cat-manage-grid"></div>

</section>

<!-- â”€â”€ REKENINGEN â”€â”€ -->
<section class="page-section" id="page-accounts">
  <div class="page-header">
    <h2>Mijn <em>Rekeningen</em></h2>
    <div class="page-date">Beheer je bankrekeningen, spaarrekeningen en kas</div>
  </div>

  <!-- Owner filter -->
  <div class="controls" style="margin-bottom:1.2rem">
    <div class="filter-row" id="owner-filter"></div>
  </div>

  <!-- Account balance cards grouped by owner -->
  <div class="account-cards" id="account-cards"></div>

  <!-- Transfer between accounts -->
  <div class="form-card" style="animation: riseUp 0.6s 0.1s ease both; margin-bottom:1.5rem">
    <div class="form-title">Overboeking <em>tussen rekeningen</em></div>
    <div class="form-grid">
      <div class="form-group">
        <label>Van rekening</label>
        <select id="transfer-from"></select>
      </div>
      <div class="form-group">
        <label>Naar rekening</label>
        <select id="transfer-to"></select>
      </div>
      <div class="form-group">
        <label>Bedrag (â‚¬)</label>
        <input type="number" id="transfer-amount" placeholder="0,00" step="0.01" min="0" />
      </div>
      <div class="form-group">
        <label>Datum</label>
        <input type="date" id="transfer-date" />
      </div>
      <div class="form-group full">
        <label>Omschrijving (optioneel)</label>
        <input type="text" id="transfer-desc" placeholder="Bijv. Spaargeld overmakenâ€¦" />
      </div>
    </div>
    <button class="add-btn btn-expense" onclick="doTransfer()" style="background:var(--blue)">â‡„ &nbsp;Overboeking uitvoeren</button>
  </div>

  <!-- Add new account form -->
  <div class="form-card" style="animation: riseUp 0.6s 0.15s ease both">
    <div class="form-title">Nieuwe <em>rekening</em> toevoegen</div>
    <div class="form-grid">
      <div class="form-group">
        <label>Naam</label>
        <input type="text" id="acc-name" placeholder="Bijv. ING Betaalrekening" maxlength="30" />
      </div>
      <div class="form-group">
        <label>Type</label>
        <select id="acc-type">
          <option value="bank">ğŸ¦ Bankrekening</option>
          <option value="savings">ğŸ’ Spaarrekening</option>
          <option value="cash">ğŸ’µ Kas / Contant</option>
          <option value="credit">ğŸ’³ Creditcard</option>
          <option value="car">ğŸš— Auto</option>
          <option value="invest">ğŸ“ˆ Beleggingen</option>
        </select>
      </div>
      <div class="form-group">
        <label>Van wie</label>
        <select id="acc-owner">
          <option value="rob">ğŸ‘¤ Rob</option>
          <option value="vriendin">ğŸ’‘ Vriendin</option>
        </select>
      </div>
      <div class="form-group">
        <label>Beginsaldo (â‚¬)</label>
        <input type="number" id="acc-balance" placeholder="0,00" step="0.01" />
      </div>
      <div class="form-group">
        <label>Kleur</label>
        <div class="color-picker" id="color-picker"></div>
      </div>
    </div>
    <button class="add-btn btn-expense" onclick="addAccount()">ğŸ¦ &nbsp;Rekening toevoegen</button>
  </div>

  <!-- Account transaction history -->
  <div id="account-tx-section" style="display:none">
    <div class="list-title">Transacties voor <em id="account-tx-title">â€”</em></div>
    <div class="transaction-list" id="account-tx-list"></div>
  </div>
</section>

<!-- â”€â”€ CRYPTO â”€â”€ -->
<section class="page-section" id="page-crypto">
  <div class="page-header">
    <h2>Mijn <em>Crypto</em></h2>
    <div class="page-date">Live koersen via CoinGecko Â· <span id="crypto-updated">â€”</span></div>
  </div>

  <!-- Portfolio totaal -->
  <div class="crypto-total-card" id="crypto-total-card">
    <div class="crypto-total-label">Totale Portfolio Waarde</div>
    <div class="crypto-total-amount" id="crypto-total-eur">â‚¬ â€”</div>
    <div class="crypto-total-sub" id="crypto-total-sub">Laden...</div>
    <button class="crypto-refresh-btn" onclick="loadCryptoPrices()" id="crypto-refresh-btn">â†» Ververs</button>
  </div>

  <!-- Coin cards -->
  <div class="crypto-grid" id="crypto-grid"></div>

  <!-- Coin toevoegen -->
  <div class="form-card" style="margin-top:1.5rem">
    <div class="form-title">Coin <em>toevoegen</em></div>
    <div class="form-grid">
      <div class="form-group">
        <label>Coin naam</label>
        <input type="text" id="crypto-name" placeholder="Bijv. Bitcoin" maxlength="30" />
      </div>
      <div class="form-group">
        <label>CoinGecko ID</label>
        <input type="text" id="crypto-id" placeholder="Bijv. bitcoin" maxlength="50" />
      </div>
      <div class="form-group">
        <label>Symbool</label>
        <input type="text" id="crypto-symbol" placeholder="Bijv. BTC" maxlength="10" />
      </div>
      <div class="form-group">
        <label>Aantal coins</label>
        <input type="number" id="crypto-amount" placeholder="0" step="any" min="0" />
      </div>
    </div>
    <div style="font-size:0.7rem;color:var(--muted);margin-bottom:0.8rem;font-weight:500">
      ğŸ’¡ Zoek de juiste ID op <a href="https://coingecko.com" target="_blank" style="color:var(--accent)">coingecko.com</a> â€” zoek je coin, de ID staat in de URL (bijv. /en/coins/<strong>bitcoin</strong>)
    </div>
    <button class="add-btn btn-income" onclick="addCryptoCoin()">â‚¿ &nbsp;Coin toevoegen</button>
  </div>
</section>
```

  </main>
</div><!-- end .layout -->
</div><!-- end #app-wrapper -->

<div class="toast" id="toast"></div>

<script>
// â”€â”€ PWA INSTALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('install-btn').style.display = 'block';
});

window.addEventListener('appinstalled', () => {
  document.getElementById('install-btn').style.display = 'none';
  toast('ğŸ‰ App geÃ¯nstalleerd op beginscherm!');
  deferredPrompt = null;
});

async function installApp() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if (outcome === 'accepted') toast('ğŸ‰ App wordt geÃ¯nstalleerd!');
    deferredPrompt = null;
    document.getElementById('install-btn').style.display = 'none';
  } else {
    // iOS fallback
    toast('ğŸ“² Tik op Delen â†’ "Zet op beginscherm"');
  }
}

// iOS: always show install hint since beforeinstallprompt doesn't fire
const isIOS = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
const isStandalone = window.navigator.standalone === true;
if (isIOS && !isStandalone) {
  document.getElementById('install-btn').style.display = 'block';
}

// â”€â”€ SERVICE WORKER (offline support) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE = 'rb-finance-v1';
    const ASSETS = [self.location.href];
    self.addEventListener('install', e => e.waitUntil(caches.open(CACHE).then(c => c.addAll(ASSETS))));
    self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
  `;
  const blob = new Blob([swCode], { type: 'application/javascript' });
  const swUrl = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swUrl).catch(() => {});
}
</script>

<script type="module">
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEFAULT_EXPENSE_CATS = {
  eten:          { label:'Eten & drinken',    icon:'ğŸ”', default:true },
  transport:     { label:'Transport',          icon:'ğŸš—', default:true },
  wonen:         { label:'Wonen',              icon:'ğŸ ', default:true },
  gezondheid:    { label:'Gezondheid',         icon:'ğŸ’Š', default:true },
  entertainment: { label:'Entertainment',      icon:'ğŸ¬', default:true },
  kleding:       { label:'Kleding',            icon:'ğŸ‘—', default:true },
  abonnement:    { label:'Abonnementen',       icon:'ğŸ“±', default:true },
  sporten:       { label:'Sporten',            icon:'ğŸƒ', default:true },
  peugeot_rob:   { label:'ğŸš™ Peugeot (Rob)',  icon:'ğŸš™', default:true },
  ford_lizet:    { label:'ğŸš˜ Ford (Lizet)',    icon:'ğŸš˜', default:true },
  overig:        { label:'Overig',             icon:'ğŸ“¦', default:true },
};

const DEFAULT_INCOME_CATS = {
  salaris:       { label:'Salaris',          icon:'ğŸ’¼', default:true },
  freelance:     { label:'Freelance',        icon:'ğŸ–¥ï¸', default:true },
  gift:          { label:'Cadeau/gift',      icon:'ğŸ', default:true },
  rente:         { label:'Rente/dividend',   icon:'ğŸ“ˆ', default:true },
  'huur-inkomen':{ label:'Huurinkomsten',    icon:'ğŸ˜ï¸', default:true },
  teruggave:     { label:'Teruggave',        icon:'â†©ï¸', default:true },
  'overig-ink':  { label:'Overig',           icon:'ğŸ’°', default:true },
};

// Custom categories â€” loaded from Firestore via subscribeToFirestore
let customExpenseCats = {};
let customIncomeCats  = {};

let EXPENSE_CATS = { ...DEFAULT_EXPENSE_CATS, ...customExpenseCats };
let INCOME_CATS  = { ...DEFAULT_INCOME_CATS,  ...customIncomeCats  };
let ALL_CATS     = { ...EXPENSE_CATS, ...INCOME_CATS };

function rebuildAllCats() {
  EXPENSE_CATS = { ...DEFAULT_EXPENSE_CATS, ...customExpenseCats };
  INCOME_CATS  = { ...DEFAULT_INCOME_CATS,  ...customIncomeCats  };
  ALL_CATS     = { ...EXPENSE_CATS, ...INCOME_CATS };
}

// â”€â”€â”€ EMOJI PICKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const EMOJI_LIST = [
  'ğŸ”','ğŸ•','ğŸ£','ğŸ¥—','ğŸœ','ğŸ¥¤','â˜•','ğŸº','ğŸ·','ğŸ›’',
  'ğŸš—','ğŸš•','ğŸšŒ','ğŸš‚','âœˆï¸','ğŸ›µ','ğŸš²','â›½','ğŸ…¿ï¸','ğŸ›£ï¸',
  'ğŸ ','ğŸ¡','ğŸ›‹ï¸','ğŸ”¨','ğŸ’¡','ğŸª´','ğŸ›','ğŸªŸ','ğŸ”‘','ğŸ—ï¸',
  'ğŸ’Š','ğŸ¥','ğŸ§˜','ğŸ‹ï¸','ğŸ¦·','ğŸ‘“','ğŸ’‰','ğŸ©º','ğŸ§¬','â¤ï¸',
  'ğŸ¬','ğŸ®','ğŸµ','ğŸ­','ğŸ–ï¸','ğŸ“š','ğŸ¨','ğŸ²','ğŸ¯','ğŸ¤',
  'ğŸ‘—','ğŸ‘Ÿ','ğŸ‘œ','ğŸ§¥','ğŸ’','ğŸ•¶ï¸','ğŸ§£','ğŸ‘’','ğŸ’„','ğŸ›ï¸',
  'ğŸ“±','ğŸ’»','ğŸ“º','ğŸ–¥ï¸','âŒš','ğŸ“·','ğŸ§','ğŸ”‹','ğŸ“¡','ğŸ–¨ï¸',
  'ğŸƒ','âš½','ğŸŠ','ğŸ¾','ğŸ‚','ğŸ§—','ğŸš´','ğŸ‡','ğŸ¤¸','ğŸ¥Š',
  'ğŸ’¼','ğŸ“Š','ğŸ¦','ğŸ’°','ğŸ’³','ğŸ“ˆ','ğŸ¤','ğŸ¢','ğŸ“‹','âœï¸',
  'ğŸ','ğŸ‚','ğŸ¥³','ğŸ’','ğŸ€','ğŸŠ','ğŸª„','ğŸ‰','ğŸ¥‚','ğŸ«¶',
  'ğŸ¶','ğŸ±','ğŸ ','ğŸ‡','ğŸŒ¿','ğŸŒ³','â˜€ï¸','ğŸŒ§ï¸','â­','ğŸŒˆ',
  'ğŸ§¹','ğŸ§º','ğŸ§»','ğŸª£','ğŸ”§','ğŸª›','ğŸªœ','ğŸ“¦','ğŸ—‚ï¸','ğŸ“‚',
];

let catType = 'expense';
let selectedEmoji = '';

function setCatType(type) {
  catType = type;
  document.getElementById('cat-btn-expense').className = 'type-btn' + (type==='expense' ? ' active-expense' : '');
  document.getElementById('cat-btn-income').className  = 'type-btn' + (type==='income'  ? ' active-income'  : '');
  document.getElementById('cat-add-btn').className = 'add-btn ' + (type==='expense' ? 'btn-expense' : 'btn-income');
}

function toggleEmojiPicker() {
  const picker = document.getElementById('emoji-picker');
  if (picker.style.display === 'none') {
    picker.style.display = 'block';
    // Build grid if empty
    const grid = document.getElementById('emoji-grid');
    if (!grid.children.length) {
      grid.innerHTML = EMOJI_LIST.map(e =>
        `<button onclick="pickEmoji('${e}')" style="
          font-size:1.4rem;width:40px;height:40px;border:none;background:none;
          cursor:pointer;border-radius:8px;transition:background 0.15s;display:flex;
          align-items:center;justify-content:center;
        " onmouseover="this.style.background='var(--card)'" onmouseout="this.style.background='none'">${e}</button>`
      ).join('');
    }
  } else {
    picker.style.display = 'none';
  }
}

function pickEmoji(emoji) {
  selectedEmoji = emoji;
  document.getElementById('cat-icon-input').value = emoji;
  document.getElementById('emoji-picker').style.display = 'none';
}

function addCustomCategory() {
  const name  = document.getElementById('cat-name').value.trim();
  const emoji = selectedEmoji || document.getElementById('cat-icon-input').value.trim();

  if (!name) { toast('âš ï¸ Vul een naam in voor de categorie.'); return; }
  if (!emoji) { toast('âš ï¸ Kies een emoji icoon.'); return; }

  // Build a key from name
  const key = 'custom_' + name.toLowerCase().replace(/[^a-z0-9]/g,'_') + '_' + Date.now();

  if (catType === 'expense') {
    customExpenseCats[key] = { label: name, icon: emoji, default: false };
  } else {
    customIncomeCats[key] = { label: name, icon: emoji, default: false };
  }

  rebuildAllCats();
  save();
  buildCategorySelect();
  buildFilters();
  renderCategoryManager();

  document.getElementById('cat-name').value = '';
  document.getElementById('cat-icon-input').value = '';
  selectedEmoji = '';
  toast(`âœ“ Categorie "${emoji} ${name}" toegevoegd!`);
}

function deleteCustomCategory(key, type) {
  const usedInTx = transactions.some(t => t.category === key);
  if (usedInTx) {
    toast('âš ï¸ Kan niet verwijderen â€” categorie is in gebruik bij transacties.');
    return;
  }
  if (type === 'expense') {
    delete customExpenseCats[key];
  } else {
    delete customIncomeCats[key];
  }
  save();
  rebuildAllCats();
  buildCategorySelect();
  buildFilters();
  renderCategoryManager();
  toast('ğŸ—‘ Categorie verwijderd.');
}

function renderCategoryManager() {
  const grid = document.getElementById('cat-manage-grid');
  if (!grid) return;

  function catList(cats, type) {
    return Object.entries(cats).map(([k, v]) => {
      const isDefault = v.default === true || DEFAULT_EXPENSE_CATS[k] || DEFAULT_INCOME_CATS[k];
      const inUse = transactions.some(t => t.category === k);
      return `
        <div class="cat-manage-item ${isDefault ? 'is-default' : ''}">
          <div class="cat-manage-emoji" style="background:${type==='expense'?'var(--accent-light)':'var(--green-light)'}">${v.icon}</div>
          <div class="cat-manage-name">${v.label}</div>
          ${isDefault ? '<span class="cat-manage-badge">Standaard</span>' : ''}
          ${inUse && !isDefault ? '<span class="cat-manage-badge">In gebruik</span>' : ''}
          <button class="cat-manage-del" onclick="deleteCustomCategory('${k}','${type}')"
            ${isDefault ? 'disabled title="Standaard categorieÃ«n kunnen niet worden verwijderd"' : ''}
            ${inUse && !isDefault ? 'disabled title="In gebruik bij transacties"' : ''}
            title="Verwijderen">âœ•</button>
        </div>`;
    }).join('');
  }

  grid.innerHTML = `
    <div class="cat-manage-col">
      <h3>Uitgave<em> categorieÃ«n</em></h3>
      <div class="cat-manage-list">${catList(EXPENSE_CATS, 'expense')}</div>
    </div>
    <div class="cat-manage-col">
      <h3>Inkomsten <em class="green">categorieÃ«n</em></h3>
      <div class="cat-manage-list">${catList(INCOME_CATS, 'income')}</div>
    </div>`;
}

const TIPS = [
  "De <em>50/30/20 regel</em>: besteed 50% aan vaste lasten, 30% aan wensen en 20% aan sparen.",
  "Een dagelijkse koffie van â‚¬3,50 kost je <em>â‚¬1.277 per jaar</em>. Klein bedrag, groot effect.",
  "Bekijk maandelijks je abonnementen â€” gemiddeld lopen er <em>2â€“3 vergeten abonnementen</em>.",
  "Boodschappen zonder lijst kosten gemiddeld <em>23% meer</em>.",
  "De beste besparing zit vaak in <em>energie en verzekeringen</em>. Vergelijken loont!",
  "Betaal jezelf eerst: zet op de 1e van de maand direct een bedrag opzij.",
  "Een <em>spaardoel</em> instellen verhoogt de kans op sparen met 42%.",
];

let transactions = [];
let goals        = [];
let budget       = 0;
let currentType  = 'expense';
let activeFilter = 'alles';
let activeFilterType = 'alles';

// â”€â”€â”€ FIREBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, collection, setDoc, deleteDoc, onSnapshot, getDoc }
  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC68DxSZll4i4oGvkDqa-JE6FmpuJCWIsg",
  authDomain: "financien-rob-lizet.firebaseapp.com",
  projectId: "financien-rob-lizet",
  storageBucket: "financien-rob-lizet.firebasestorage.app",
  messagingSenderId: "146252754953",
  appId: "1:146252754953:web:31e488d81fc92f77bb88d8"
};

const fbApp  = initializeApp(firebaseConfig);
const auth   = getAuth(fbApp);
const db     = getFirestore(fbApp);

let currentUser = null;
let unsubscribers = [];

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showLoginScreen() {
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('app-wrapper').style.display  = 'none';
}

function showAppScreen() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app-wrapper').style.display  = 'grid';
}

async function loginWithGoogle() {
  try {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
  } catch(e) {
    alert('Inloggen mislukt: ' + e.message);
  }
}

async function logoutUser() {
  unsubscribers.forEach(u => u());
  unsubscribers = [];
  await signOut(auth);
  transactions = []; goals = []; budget = 0;
  accounts = []; transfers = [];
  customExpenseCats = {}; customIncomeCats = {};
}

onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;
    const name = user.displayName?.split(' ')[0] || 'Rob';
    document.getElementById('greeting-name').textContent = name;
    document.getElementById('sb-user-name').textContent  = name;
    document.getElementById('sb-user-email').textContent = user.email;
    document.getElementById('sb-user-avatar').src        = user.photoURL || '';
    showAppScreen();
    subscribeToFirestore();
  } else {
    currentUser = null;
    showLoginScreen();
  }
});

// â”€â”€â”€ FIRESTORE HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sharedRef(path) {
  // All data is shared in one "household" â€” projectId is the household
  return doc(db, 'households', 'financien-rob-lizet', path);
}

function sharedCol(path) {
  return collection(db, 'households', 'financien-rob-lizet', path);
}

// â”€â”€â”€ REALTIME SUBSCRIPTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function subscribeToFirestore() {
  unsubscribers.forEach(u => u());
  unsubscribers = [];

  // Transactions
  unsubscribers.push(onSnapshot(sharedCol('transactions'), snap => {
    transactions = snap.docs.map(d => d.data());
    transactions.sort((a,b) => b.date.localeCompare(a.date) || b.id - a.id);
    render();
  }));

  // Goals
  unsubscribers.push(onSnapshot(sharedCol('goals'), snap => {
    goals = snap.docs.map(d => d.data());
    renderGoals();
  }));

  // Accounts
  unsubscribers.push(onSnapshot(sharedCol('accounts'), snap => {
    accounts = snap.docs.map(d => d.data());
    migrateAccountsIfNeeded();
    buildAccountSelects();
    if (document.getElementById('page-accounts').classList.contains('active')) renderAccountsPage();
  }));

  // Transfers
  unsubscribers.push(onSnapshot(sharedCol('transfers'), snap => {
    transfers = snap.docs.map(d => d.data());
    if (document.getElementById('page-accounts').classList.contains('active')) renderAccountsPage();
  }));

  // Settings (budget, custom cats)
  unsubscribers.push(onSnapshot(sharedRef('settings/main'), snap => {
    const data = snap.data() || {};
    budget = data.budget || 0;
    customExpenseCats = data.customExpenseCats || {};
    customIncomeCats  = data.customIncomeCats  || {};
    rebuildAllCats();
    buildCategorySelect();
    document.getElementById('budget-input').value = budget || '';
    renderBudget();
  }));

  // Crypto coins
  unsubscribers.push(onSnapshot(sharedRef('settings/crypto'), snap => {
    const data = snap.data() || {};
    cryptoCoins = data.coins || defaultCryptoCoins();
    if (document.getElementById('page-crypto').classList.contains('active')) renderCryptoPage();
  }));
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('date').value = new Date().toISOString().split('T')[0];
document.getElementById('header-date').textContent = new Date().toLocaleDateString('nl-NL',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
document.getElementById('tip-text').innerHTML = TIPS[Math.floor(Math.random() * TIPS.length)];
buildCategorySelect();
buildFilters();

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmt(n) {
  return 'â‚¬\u00a0' + Math.abs(n).toFixed(2).replace('.',',').replace(/\B(?=(\d{3})+(?!\d))/g,'.');
}

function fmtDate(d) {
  return new Date(d+'T12:00:00').toLocaleDateString('nl-NL',{day:'numeric',month:'short',year:'numeric'});
}

function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2400);
}

function getMonth(tx) {
  const now = new Date();
  const d = new Date(tx.date+'T12:00:00');
  return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
}

function monthTotals() {
  const inc = transactions.filter(t => t.type==='income' && getMonth(t)).reduce((s,t)=>s+t.amount,0);
  const exp = transactions.filter(t => t.type==='expense' && getMonth(t)).reduce((s,t)=>s+t.amount,0);
  return { inc, exp };
}

// â”€â”€â”€ FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setType(type) {
  currentType = type;
  document.getElementById('btn-expense').className = 'type-btn' + (type==='expense' ? ' active-expense' : '');
  document.getElementById('btn-income').className  = 'type-btn' + (type==='income'  ? ' active-income'  : '');
  document.getElementById('add-btn').className = 'add-btn ' + (type==='expense' ? 'btn-expense' : 'btn-income');
  buildCategorySelect();
}

function buildCategorySelect() {
  const sel = document.getElementById('category');
  const cats = currentType === 'expense' ? EXPENSE_CATS : INCOME_CATS;
  sel.innerHTML = Object.entries(cats).map(([k,v]) =>
    `<option value="${k}">${v.icon} ${v.label}</option>`
  ).join('');
}

// â”€â”€â”€ BUDGET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateBudget() {
  budget = parseFloat(document.getElementById('budget-input').value) || 0;
  save();
  renderBudget();
}

function renderBudget() {
  const { exp } = monthTotals();
  const fill  = document.getElementById('budget-fill');
  const spent = document.getElementById('budget-spent');
  const left  = document.getElementById('budget-left');

  spent.textContent = fmt(exp) + ' uitgegeven';
  if (!budget) { fill.style.width='0%'; left.textContent='Stel budget in â†’'; fill.className='budget-fill'; return; }

  const pct = Math.min((exp/budget)*100, 100);
  fill.style.width = pct+'%';
  fill.className = 'budget-fill'+(pct>=100?' over':pct>=75?' warn':'');
  const rem = budget - exp;
  left.textContent = rem <= 0 ? 'ğŸ”´ '+fmt(rem)+' over budget' : fmt(rem)+' resterend';
}

// â”€â”€â”€ CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderChart(containerId) {
  const now = new Date();
  const months = [];
  for (let i=5;i>=0;i--) {
    const d = new Date(now.getFullYear(), now.getMonth()-i, 1);
    months.push({ m:d.getMonth(), y:d.getFullYear(), lbl:d.toLocaleDateString('nl-NL',{month:'short'}) });
  }

  const incTotals = months.map(mo => transactions.filter(t=>t.type==='income'&&new Date(t.date+'T12:00:00').getMonth()===mo.m&&new Date(t.date+'T12:00:00').getFullYear()===mo.y).reduce((s,t)=>s+t.amount,0));
  const expTotals = months.map(mo => transactions.filter(t=>t.type==='expense'&&new Date(t.date+'T12:00:00').getMonth()===mo.m&&new Date(t.date+'T12:00:00').getFullYear()===mo.y).reduce((s,t)=>s+t.amount,0));
  const maxVal = Math.max(...incTotals, ...expTotals, 1);

  document.getElementById(containerId).innerHTML = months.map((mo,i) => `
    <div class="chart-col">
      <div class="chart-bar-pair">
        <div class="bar inc" style="height:${Math.max((incTotals[i]/maxVal)*90,3)}px" title="Inkomsten ${fmt(incTotals[i])}"></div>
        <div class="bar exp" style="height:${Math.max((expTotals[i]/maxVal)*90,3)}px" title="Uitgaven ${fmt(expTotals[i])}"></div>
      </div>
      <div class="chart-lbl">${mo.lbl}</div>
    </div>
  `).join('');
}

// â”€â”€â”€ FILTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildFilters() {
  const filterCats = ['alles', 'income', 'expense', ...Object.keys(EXPENSE_CATS), ...Object.keys(INCOME_CATS)];
  document.getElementById('filter-row').innerHTML = [
    {k:'alles',  lbl:'Alles'},
    {k:'income', lbl:'ğŸ’š Inkomsten'},
    {k:'expense',lbl:'ğŸ”´ Uitgaven'},
    ...Object.entries(EXPENSE_CATS).map(([k,v])=>({k,lbl:v.icon+' '+v.label})),
    ...Object.entries(INCOME_CATS).map(([k,v])=>({k,lbl:v.icon+' '+v.label})),
  ].map(f=>`<button class="filter-btn ${f.k===activeFilter?'active':''}" onclick="setFilter('${f.k}',this)">${f.lbl}</button>`).join('');
}

function setFilter(cat, btn) {
  activeFilter = cat;
  buildFilters();
  renderTransactions();
}

// â”€â”€â”€ TRANSACTION LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTransactions() {
  let list = [...transactions];

  if (activeFilter === 'income')  list = list.filter(t=>t.type==='income');
  else if (activeFilter === 'expense') list = list.filter(t=>t.type==='expense');
  else if (activeFilter !== 'alles') list = list.filter(t=>t.category===activeFilter);

  const sort = document.getElementById('sort-select').value;
  if      (sort==='date-desc')   list.sort((a,b)=>b.date.localeCompare(a.date)||b.id-a.id);
  else if (sort==='date-asc')    list.sort((a,b)=>a.date.localeCompare(b.date)||a.id-b.id);
  else if (sort==='amount-desc') list.sort((a,b)=>b.amount-a.amount);
  else if (sort==='amount-asc')  list.sort((a,b)=>a.amount-b.amount);

  renderList('all-list', list, true);
}

function renderList(id, list, paginated=false) {
  const el = document.getElementById(id);
  if (!list.length) {
    el.innerHTML = `<div class="empty-state"><span class="icon">ğŸ“­</span>Geen transacties gevonden</div>`;
    return;
  }
  el.innerHTML = (paginated ? list : list.slice(0,8)).map((t,i)=>txHTML(t,i)).join('');
}

function deleteTransaction(id) {
  deleteTxFromDB(id);
  toast('ğŸ—‘ Verwijderd.');
}

// â”€â”€â”€ INSIGHTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderInsights() {
  // Category breakdown
  const byCat = {};
  transactions.filter(t=>t.type==='expense'&&getMonth(t)).forEach(t => {
    byCat[t.category] = (byCat[t.category]||0) + t.amount;
  });

  const sorted = Object.entries(byCat).sort((a,b)=>b[1]-a[1]).slice(0,6);
  const max = sorted[0]?.[1] || 1;
  const catEl = document.getElementById('cat-breakdown');

  if (!sorted.length) {
    catEl.innerHTML = '<div style="color:var(--muted);font-size:0.75rem;text-align:center;padding:1rem">Nog geen uitgaven deze maand</div>';
  } else {
    catEl.innerHTML = sorted.map(([k,v]) => {
      const cat = EXPENSE_CATS[k] || {icon:'ğŸ“¦',label:'Overig'};
      return `<div class="cat-row">
        <div class="cat-row-icon">${cat.icon}</div>
        <div class="cat-row-label">${cat.label}</div>
        <div class="cat-row-bar-wrap"><div class="cat-row-bar" style="width:${(v/max)*100}%"></div></div>
        <div class="cat-row-amt">${fmt(v)}</div>
      </div>`;
    }).join('');
  }

  // Savings rate
  const { inc, exp } = monthTotals();
  const saved = inc - exp;
  const rate  = inc > 0 ? Math.max(0, Math.min(saved/inc, 1)) : 0;
  const circ  = 251.2;
  document.getElementById('savings-pct').textContent = Math.round(rate*100)+'%';
  document.getElementById('circle-val').style.strokeDashoffset = circ - rate*circ;
  document.getElementById('circle-val').style.stroke = rate >= 0.2 ? 'var(--green)' : rate > 0 ? '#e8a060' : 'var(--red)';
  document.getElementById('savings-sub').textContent = inc > 0
    ? `${fmt(saved)} gespaard van ${fmt(inc)} inkomsten`
    : 'Voeg inkomsten toe om te berekenen';
}

// â”€â”€â”€ GOALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addGoal() {
  const name   = document.getElementById('goal-name').value.trim();
  const target = parseFloat(document.getElementById('goal-target').value);
  const saved  = parseFloat(document.getElementById('goal-saved').value) || 0;

  if (!name || isNaN(target) || target <= 0) {
    toast('âš ï¸ Vul naam en doelbedrag in.');
    return;
  }

  const goal = { id: Date.now(), name, target, saved };
  saveGoalToDB(goal);
  toast('ğŸ¯ Doel toegevoegd!');
  document.getElementById('goal-name').value = '';
  document.getElementById('goal-target').value = '';
  document.getElementById('goal-saved').value = '';
}

function deleteGoal(id) {
  deleteGoalFromDB(id);
  toast('ğŸ—‘ Doel verwijderd.');
}

function updateGoalSaved(id, val) {
  const g = goals.find(g=>g.id===id);
  if (g) { g.saved = Math.max(0, parseFloat(val)||0); saveGoalToDB(g); }
}

function renderGoals() {
  const el = document.getElementById('goals-list');
  if (!goals.length) {
    el.innerHTML = `<div class="empty-state"><span class="icon">ğŸ¯</span>Nog geen doelen ingesteld</div>`;
    return;
  }

  el.innerHTML = goals.map(g => {
    const pct = Math.min((g.saved/g.target)*100, 100);
    const done = pct >= 100;
    return `<div class="goal-item">
      <div class="goal-header">
        <div>
          <div class="goal-name">${done?'âœ… ':''}${g.name}</div>
          <div class="goal-amounts">${fmt(g.saved)} van ${fmt(g.target)}</div>
        </div>
        <button class="goal-delete" onclick="deleteGoal(${g.id})">âœ•</button>
      </div>
      <div class="goal-track">
        <div class="goal-fill${done?' done':''}" style="width:${pct}%"></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:0.5rem">
        <div class="goal-pct">${Math.round(pct)}% bereikt</div>
        <div style="display:flex;align-items:center;gap:0.4rem;font-size:0.7rem;color:var(--muted)">
          Gespaard: â‚¬ <input type="number" value="${g.saved}" min="0" step="10" onchange="updateGoalSaved(${g.id},this.value)"
            style="width:75px;background:var(--card);border:1px solid var(--border);border-radius:6px;padding:0.2rem 0.4rem;font-family:'Space Grotesk',sans-serif;font-size:0.75rem;color:var(--ink);outline:none;" />
        </div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€â”€ ACCOUNTS DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ACC_TYPES = {
  bank:    { label: 'Bankrekening',    icon: 'ğŸ¦' },
  savings: { label: 'Spaarrekening',   icon: 'ğŸ’' },
  cash:    { label: 'Kas / Contant',   icon: 'ğŸ’µ' },
  credit:  { label: 'Creditcard',      icon: 'ğŸ’³' },
  invest:  { label: 'Beleggingen',     icon: 'ğŸ“ˆ' },
  car:     { label: 'Auto',            icon: 'ğŸš—' },
};

const ACC_COLORS = ['#b85c28','#2d7a50','#2e5f8a','#8a5faf','#b08a3a','#2a8a8a','#b83028','#607a2a','#003d82','#c8002a','#e87722','#ffb3c7'];

let accounts   = [];
let transfers  = [];
let selectedAccColor = ACC_COLORS[0];
let activeAccountId  = null;
let activeOwnerFilter = 'alles';

// Seed default accounts into Firestore if the collection is empty (called from subscription)
function migrateAccountsIfNeeded() {
  if (accounts.length === 0) {
    const defaults = [
      { id: 'acc_rob_ing',      name: 'ING Betaalrekening',  type: 'bank',   color: '#e87722', startBalance: 0, owner: 'rob' },
      { id: 'acc_rob_anwb',     name: 'ANWB Creditcard',     type: 'credit', color: '#003d82', startBalance: 0, owner: 'rob' },
      { id: 'acc_rob_ingcc',    name: 'ING Creditcard',      type: 'credit', color: '#e87722', startBalance: 0, owner: 'rob' },
      { id: 'acc_rob_klarna',   name: 'Klarna',               type: 'credit', color: '#ffb3c7', startBalance: 0, owner: 'rob' },
      { id: 'acc_rob_peugeot',  name: 'Peugeot Rob',          type: 'car',    color: '#7a2040', startBalance: 0, owner: 'rob' },
      { id: 'acc_vr_rabo',      name: 'RABO Betaalrekening',  type: 'bank',   color: '#c8002a', startBalance: 0, owner: 'vriendin' },
      { id: 'acc_vr_cc',        name: 'Creditcard Vriendin',  type: 'credit', color: '#2d7a50', startBalance: 0, owner: 'vriendin' },
      { id: 'acc_vr_ford',      name: 'Ford Lizet',           type: 'car',    color: '#6b8fa8', startBalance: 0, owner: 'vriendin' },
    ];
    defaults.forEach(acc => saveAccountToDB(acc));
  } else {
    // Always force correct car colors
    const peugeot = accounts.find(a => a.id === 'acc_rob_peugeot');
    const ford    = accounts.find(a => a.id === 'acc_vr_ford');
    if (peugeot) saveAccountToDB({...peugeot, color: '#7a2040', owner: 'rob'});
    if (ford)    saveAccountToDB({...ford,    color: '#6b8fa8', owner: 'vriendin'});
  }
}

function saveAccounts() {
  // no-op: accounts are saved individually to Firestore via saveAccountToDB
}

// â”€â”€â”€ ACCOUNT BALANCE CALCULATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getAccountBalance(accId) {
  const acc = accounts.find(a => a.id === accId);
  if (!acc) return 0;
  let bal = acc.startBalance || 0;
  transactions.forEach(t => {
    if (t.account !== accId) return;
    bal += t.type === 'income' ? t.amount : -t.amount;
  });
  transfers.forEach(tr => {
    if (tr.from === accId) bal -= tr.amount;
    if (tr.to   === accId) bal += tr.amount;
  });
  return bal;
}

// â”€â”€â”€ ADD / DELETE ACCOUNT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addAccount() {
  const name    = document.getElementById('acc-name').value.trim();
  const type    = document.getElementById('acc-type').value;
  const balance = parseFloat(document.getElementById('acc-balance').value) || 0;
  const owner   = document.getElementById('acc-owner').value;

  if (!name) { toast('âš ï¸ Vul een naam in voor de rekening.'); return; }

  const id = 'acc_' + Date.now();
  const acc = { id, name, type, color: selectedAccColor, startBalance: balance, owner };
  saveAccountToDB(acc);
  toast(`âœ“ Rekening "${name}" toegevoegd!`);
  document.getElementById('acc-name').value    = '';
  document.getElementById('acc-balance').value = '';
}

function deleteAccount(id) {
  const inUse = transactions.some(t => t.account === id);
  if (inUse) { toast('âš ï¸ Rekening is in gebruik bij transacties â€” kan niet verwijderen.'); return; }
  deleteAccountFromDB(id);
  toast('ğŸ—‘ Rekening verwijderd.');
}

// â”€â”€â”€ TRANSFER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doTransfer() {
  const from   = document.getElementById('transfer-from').value;
  const to     = document.getElementById('transfer-to').value;
  const amount = parseFloat(document.getElementById('transfer-amount').value);
  const date   = document.getElementById('transfer-date').value;
  const desc   = document.getElementById('transfer-desc').value.trim() || 'Overboeking';

  if (from === to)       { toast('âš ï¸ Van en naar rekening zijn hetzelfde.'); return; }
  if (!amount || amount <= 0) { toast('âš ï¸ Vul een geldig bedrag in.'); return; }
  if (!date)             { toast('âš ï¸ Vul een datum in.'); return; }

  const tr = { id: Date.now(), from, to, amount, date, desc };
  saveTransferToDB(tr);
  toast('â‡„ Overboeking uitgevoerd!');
  document.getElementById('transfer-amount').value = '';
  document.getElementById('transfer-desc').value   = '';
}

// â”€â”€â”€ BUILD ACCOUNT SELECTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildAccountSelects() {
  const robAccs = accounts.filter(a => (a.owner||'rob') === 'rob');
  const vrAccs  = accounts.filter(a => a.owner === 'vriendin');

  function makeOpts(list) {
    return list.map(a => `<option value="${a.id}">${ACC_TYPES[a.type]?.icon||'ğŸ¦'} ${a.name}</option>`).join('');
  }

  const opts = `
    <optgroup label="ğŸ‘¤ Rob">${makeOpts(robAccs)}</optgroup>
    <optgroup label="ğŸ’‘ Vriendin">${makeOpts(vrAccs)}</optgroup>`;

  const sel = document.getElementById('account-select');
  if (sel) sel.innerHTML = opts;

  const tf = document.getElementById('transfer-from');
  const tt = document.getElementById('transfer-to');
  if (tf) tf.innerHTML = opts;
  if (tt) { tt.innerHTML = opts; if (accounts.length > 1) tt.selectedIndex = 1; }
}

// â”€â”€â”€ COLOR PICKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildColorPicker() {
  const el = document.getElementById('color-picker');
  if (!el) return;
  el.innerHTML = ACC_COLORS.map(c =>
    `<div class="color-dot ${c===selectedAccColor?'selected':''}" style="background:${c}" onclick="pickAccColor('${c}')"></div>`
  ).join('');
}

function pickAccColor(color) {
  selectedAccColor = color;
  buildColorPicker();
}

// â”€â”€â”€ RENDER ACCOUNTS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAccountsPage() {
  buildColorPicker();
  buildAccountSelects();

  const cardsEl = document.getElementById('account-cards');
  if (!cardsEl) return;

  // Owner filter buttons
  const ownerFilterEl = document.getElementById('owner-filter');
  if (ownerFilterEl) {
    ownerFilterEl.innerHTML = [
      { k:'alles',     lbl:'ğŸ‘¥ Iedereen' },
      { k:'rob',       lbl:'ğŸ‘¤ Rob' },
      { k:'vriendin',  lbl:'ğŸ’‘ Vriendin' },
    ].map(f => `<button class="filter-btn ${f.k===activeOwnerFilter?'active':''}" onclick="setOwnerFilter('${f.k}')">${f.lbl}</button>`).join('');
  }

  const filtered = activeOwnerFilter === 'alles' ? accounts : accounts.filter(a => (a.owner||'rob') === activeOwnerFilter);

  if (!filtered.length) {
    cardsEl.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><span class="icon">ğŸ¦</span>Geen rekeningen gevonden</div>`;
  } else {
    const groups = [
      { key:'rob',      label:'ğŸ‘¤ Rob' },
      { key:'vriendin', label:'ğŸ’‘ Vriendin' },
    ];
    const toShow = activeOwnerFilter === 'alles' ? groups : groups.filter(g => g.key === activeOwnerFilter);

    cardsEl.innerHTML = toShow.map(group => {
      const groupAccs = filtered.filter(a => (a.owner||'rob') === group.key);
      if (!groupAccs.length) return '';

      const groupTotal = groupAccs.reduce((s, a) => s + getAccountBalance(a.id), 0);
      const cards = groupAccs.map(acc => {
        const bal      = getAccountBalance(acc.id);
        const type     = ACC_TYPES[acc.type] || { label:'Rekening', icon:'ğŸ¦' };
        const txCount  = transactions.filter(t => t.account === acc.id).length;
        const selected = activeAccountId === acc.id;
        return `
          <div class="account-card ${selected?'selected':''}"
               style="border-color:${selected?acc.color:'var(--border)'}"
               onclick="showAccountTx('${acc.id}')">
            <div style="position:absolute;top:0;left:0;right:0;height:3px;background:${acc.color};border-radius:16px 16px 0 0"></div>
            <div class="account-card-top">
              <div class="account-card-icon" style="background:${acc.color}22">${type.icon}</div>
              <button class="account-card-del" onclick="event.stopPropagation();deleteAccount('${acc.id}')" title="Verwijderen">âœ•</button>
            </div>
            <div class="account-card-name">${acc.name}</div>
            <div class="account-card-type">${type.label}</div>
            <div class="account-card-balance ${bal<0?'negative':''}">${bal<0?'âˆ’ ':''}${fmt(bal)}</div>
            <div class="account-card-sub">${txCount} transactie${txCount!==1?'s':''}</div>
          </div>`;
      }).join('');

      return `
        <div class="owner-group">
          <div class="owner-group-header">
            <span class="owner-group-name">${group.label}</span>
            <span class="owner-group-total ${groupTotal<0?'negative':''}">${groupTotal<0?'âˆ’ ':''}${fmt(groupTotal)}</span>
          </div>
          <div class="owner-cards-row">${cards}</div>
        </div>`;
    }).join('');
  }

  // Transfer date default
  const td = document.getElementById('transfer-date');
  if (td && !td.value) td.value = new Date().toISOString().split('T')[0];

  // Account transaction history
  if (activeAccountId) {
    const acc       = accounts.find(a => a.id === activeAccountId);
    const titleEl   = document.getElementById('account-tx-title');
    const sectionEl = document.getElementById('account-tx-section');
    const listEl    = document.getElementById('account-tx-list');
    if (acc && titleEl && sectionEl && listEl) {
      const ownerLabel = acc.owner === 'vriendin' ? 'ğŸ’‘' : 'ğŸ‘¤';
      titleEl.textContent = `${ACC_TYPES[acc.type]?.icon||'ğŸ¦'} ${acc.name}`;
      sectionEl.style.display = 'block';

      const txList = transactions.filter(t => t.account === activeAccountId).map(t => ({...t, _isTx:true}));

      transfers.filter(tr => tr.from===activeAccountId || tr.to===activeAccountId).forEach(tr => {
        const isOut    = tr.from === activeAccountId;
        const otherAcc = accounts.find(a => a.id === (isOut ? tr.to : tr.from));
        txList.push({
          id: tr.id, _isTransfer: true, type: isOut ? 'expense' : 'income',
          desc: tr.desc + (otherAcc ? ` ${isOut?'â†’':'â†'} ${otherAcc.name}` : ''),
          amount: tr.amount, date: tr.date, category: '_transfer', note: 'Overboeking'
        });
      });

      txList.sort((a,b) => b.date.localeCompare(a.date));

      listEl.innerHTML = txList.length
        ? txList.map((t,i) => txHTML(t,i)).join('')
        : `<div class="empty-state"><span class="icon">ğŸ“­</span>Geen transacties voor deze rekening</div>`;
    }
  } else {
    const s = document.getElementById('account-tx-section');
    if (s) s.style.display = 'none';
  }
}

function setOwnerFilter(owner) {
  activeOwnerFilter = owner;
  activeAccountId   = null;
  renderAccountsPage();
}

function showAccountTx(accId) {
  activeAccountId = activeAccountId === accId ? null : accId;
  renderAccountsPage();
}

// â”€â”€â”€ UPDATED txHTML â€” shows account badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function txHTML(t, idx) {
  const cat  = t.category === '_transfer'
    ? { icon:'â‡„', label:'Overboeking' }
    : (ALL_CATS[t.category] || { icon:'ğŸ“¦', label:'Overig' });
  const sign = t.type === 'income' ? '+' : 'âˆ’';
  const acc  = accounts.find(a => a.id === t.account);
  const badge = acc
    ? `<span class="tx-account-badge" style="background:${acc.color}">${ACC_TYPES[acc.type]?.icon||'ğŸ¦'} ${acc.name}</span>`
    : '';
  const delBtn = t._isTransfer
    ? ''
    : `<button class="tx-delete" onclick="deleteTransaction(${t.id})" title="Verwijderen">âœ•</button>`;

  return `
    <div class="tx-item is-${t.type}" style="animation-delay:${idx*0.025}s">
      <div class="tx-icon cat-${t.category}" style="${t.category==='_transfer'?'background:#e3ecf5':''}">${cat.icon}</div>
      <div>
        <div class="tx-desc">${t.desc}</div>
        <div class="tx-meta">${t.type==='income'?'Inkomst':'Uitgave'} Â· ${cat.label} Â· ${fmtDate(t.date)}${t.note?' Â· '+t.note:''}${badge}</div>
      </div>
      <div class="tx-amount ${t.type}">${sign} ${fmt(t.amount)}</div>
      ${delBtn}
    </div>`;
}

// â”€â”€â”€ UPDATED addTransaction â€” saves account â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addTransaction() {
  const desc   = document.getElementById('desc').value.trim();
  const amount = parseFloat(document.getElementById('amount').value);
  const cat    = document.getElementById('category').value;
  const date   = document.getElementById('date').value;
  const note   = document.getElementById('note').value.trim();
  const account = document.getElementById('account-select')?.value || (accounts[0]?.id || '');
  const addedBy = currentUser?.displayName?.split(' ')[0] || 'onbekend';

  if (!desc || isNaN(amount) || amount <= 0 || !date) {
    toast('âš ï¸ Vul omschrijving, bedrag en datum in.');
    return;
  }

  const tx = { id: Date.now(), type: currentType, desc, amount, category: cat, date, note, account, addedBy };
  saveTx(tx);
  toast(currentType === 'expense' ? 'âœ“ Uitgave toegevoegd!' : 'âœ“ Inkomst toegevoegd!');

  document.getElementById('desc').value    = '';
  document.getElementById('amount').value  = '';
  document.getElementById('note').value    = '';
  document.getElementById('date').value    = new Date().toISOString().split('T')[0];
}

// â”€â”€â”€ UPDATED showPage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(page) {
  document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  document.querySelector(`.nav-item[onclick="showPage('${page}')"]`).classList.add('active');
  if (page === 'categories') renderCategoryManager();
  else if (page === 'accounts') renderAccountsPage();
  else if (page === 'crypto') { renderCryptoPage(); loadCryptoPrices(); }
  else render();
}

// â”€â”€â”€ FIRESTORE SAVE FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function save() {
  // budget + custom cats in settings
  await setDoc(sharedRef('settings/main'), {
    budget,
    customExpenseCats,
    customIncomeCats,
  });
}

async function saveTx(tx) {
  await setDoc(doc(sharedCol('transactions'), String(tx.id)), tx);
}

async function deleteTxFromDB(id) {
  await deleteDoc(doc(sharedCol('transactions'), String(id)));
}

async function saveGoalToDB(goal) {
  await setDoc(doc(sharedCol('goals'), String(goal.id)), goal);
}

async function deleteGoalFromDB(id) {
  await deleteDoc(doc(sharedCol('goals'), String(id)));
}

async function saveAccountToDB(acc) {
  await setDoc(doc(sharedCol('accounts'), acc.id), acc);
}

async function deleteAccountFromDB(id) {
  await deleteDoc(doc(sharedCol('accounts'), id));
}

async function saveTransferToDB(tr) {
  await setDoc(doc(sharedCol('transfers'), String(tr.id)), tr);
}

async function saveCryptoDB() {
  await setDoc(sharedRef('settings/crypto'), { coins: cryptoCoins });
}

// â”€â”€â”€ INIT ACCOUNTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
buildAccountSelects();
buildColorPicker();
function renderSidebarBalance() {
  const { inc, exp } = monthTotals();
  const bal = inc - exp;
  const el = document.getElementById('sb-balance');
  el.textContent = (bal < 0 ? 'âˆ’ ' : '') + fmt(bal);
  el.className = 'bal-amount' + (bal > 0 ? ' positive' : bal < 0 ? ' negative' : '');
  document.getElementById('sb-balance-sub').textContent = `${fmt(inc)} inkomen Â· ${fmt(exp)} uitgaven`;
}

// â”€â”€â”€ SUMMARY CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSummary() {
  const now = new Date();
  const { inc, exp } = monthTotals();
  const bal = inc - exp;
  const mExp = transactions.filter(t=>t.type==='expense'&&getMonth(t));
  const mInc = transactions.filter(t=>t.type==='income'&&getMonth(t));
  const avg  = exp / (now.getDate()||1);

  document.getElementById('sc-income').textContent      = fmt(inc);
  document.getElementById('sc-expense').textContent     = fmt(exp);
  document.getElementById('sc-balance').textContent     = (bal<0?'âˆ’ ':'')+fmt(bal);
  document.getElementById('sc-avg').textContent         = fmt(avg);
  document.getElementById('sc-income-sub').textContent  = mInc.length+' transacties';
  document.getElementById('sc-expense-sub').textContent = mExp.length+' transacties';

  const balEl = document.getElementById('sc-balance');
  balEl.className = 'sc-num' + (bal < 0 ? ' negative' : '');
}

// â”€â”€â”€ MAIN RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  renderSummary();
  renderBudget();
  renderChart('chart-bars');
  renderChart('chart-bars-2');
  renderList('recent-list', transactions.slice(0,6));
  buildFilters();
  renderTransactions();
  renderInsights();
  renderGoals();
  renderSidebarBalance();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€â”€ CRYPTO MODULE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CRYPTO_STORAGE_KEY = 'rb_crypto_v1';
const CRYPTO_COLORS = {
  devve:        '#4a90e2',
  fias:         '#f5a623',
  bitcoin:      '#f7931a',
  ethereum:     '#627eea',
  default:      '#8a5faf',
};

// Default coins: DevvE + FIAS pre-loaded
function defaultCryptoCoins() {
  return [
    { id: 'devve',        name: 'DevvE',      symbol: 'DEVVE', amount: 0, color: '#4a90e2' },
    { id: 'fias',         name: 'FIAS',       symbol: 'FIAS',  amount: 0, color: '#f5a623' },
  ];
}

let cryptoCoins = defaultCryptoCoins();
let cryptoPriceCache = {};

function saveCryptoDB_stub() {} // replaced by real saveCryptoDB above

// â”€â”€â”€ FETCH LIVE PRICES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadCryptoPrices() {
  if (!cryptoCoins.length) return;

  const btn = document.getElementById('crypto-refresh-btn');
  if (btn) { btn.textContent = 'â†»'; btn.classList.add('spinning'); }

  const ids = [...new Set(cryptoCoins.map(c => c.id))].join(',');

  try {
    // Fetch coin prices in EUR + USD, with 24h change
    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=eur,usd&include_24hr_change=true`;
    const res  = await fetch(url);

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    const now = Date.now();
    for (const id of ids.split(',')) {
      if (data[id]) {
        cryptoPriceCache[id] = {
          eur:       data[id].eur       || 0,
          usd:       data[id].usd       || 0,
          change24h: data[id].eur_24h_change || 0,
          fetchedAt: now,
        };
      }
    }

    // Update timestamp
    const updEl = document.getElementById('crypto-updated');
    if (updEl) updEl.textContent = 'bijgewerkt ' + new Date().toLocaleTimeString('nl-NL', { hour:'2-digit', minute:'2-digit' });

    renderCryptoPage();

  } catch (err) {
    const grid = document.getElementById('crypto-grid');
    if (grid) {
      const errDiv = document.createElement('div');
      errDiv.className = 'crypto-error';
      errDiv.textContent = `âš ï¸ Kon koersen niet ophalen: ${err.message}. Controleer je internetverbinding.`;
      grid.prepend(errDiv);
    }
    // Still render with cached/zero prices
    renderCryptoPage();
  } finally {
    if (btn) btn.classList.remove('spinning');
    if (btn) btn.textContent = 'â†» Ververs';
  }
}

// â”€â”€â”€ RENDER CRYPTO PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCryptoPage() {
  const grid = document.getElementById('crypto-grid');
  if (!grid) return;

  // Clear old error messages
  grid.querySelectorAll('.crypto-error').forEach(e => e.remove());

  if (!cryptoCoins.length) {
    grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><span class="icon">â‚¿</span>Nog geen coins toegevoegd</div>`;
    updateCryptoTotal();
    return;
  }

  grid.innerHTML = cryptoCoins.map((coin, idx) => {
    const price  = cryptoPriceCache[coin.id];
    const eurPrice  = price?.eur   ?? null;
    const change    = price?.change24h ?? null;
    const eurValue  = (eurPrice !== null && coin.amount) ? eurPrice * coin.amount : null;
    const color     = coin.color || CRYPTO_COLORS[coin.id] || CRYPTO_COLORS.default;
    const initials  = coin.symbol.slice(0,3).toUpperCase();

    // Change badge
    let changeBadge = '';
    if (change !== null) {
      const cls  = change > 0.05 ? 'up' : change < -0.05 ? 'down' : 'flat';
      const sign = change > 0 ? '+' : '';
      changeBadge = `<span class="crypto-change ${cls}">${sign}${change.toFixed(2)}%</span>`;
    }

    // Price display
    const priceDisplay = eurPrice !== null
      ? `â‚¬ ${eurPrice < 0.01 ? eurPrice.toFixed(6) : eurPrice < 1 ? eurPrice.toFixed(4) : eurPrice.toLocaleString('nl-NL', {minimumFractionDigits:2, maximumFractionDigits:2})}`
      : `<span style="color:var(--muted);font-size:0.9rem">Ladenâ€¦</span>`;

    // EUR value
    const valueDisplay = eurValue !== null
      ? `<div class="crypto-eur-value">${fmt(eurValue)}</div><div class="crypto-eur-label">jouw waarde</div>`
      : `<div class="crypto-eur-value" style="color:var(--muted)">â€”</div><div class="crypto-eur-label">voer aantal in</div>`;

    return `
      <div class="crypto-card" style="border-top: 3px solid ${color}">
        <div class="crypto-card-top">
          <div class="crypto-coin-info">
            <div class="crypto-coin-icon" style="background:${color}">${initials}</div>
            <div>
              <div class="crypto-coin-name">${coin.name}</div>
              <div class="crypto-coin-symbol">${coin.symbol}</div>
            </div>
          </div>
          <button class="crypto-card-del" onclick="deleteCryptoCoin(${idx})">âœ•</button>
        </div>
        <div class="crypto-price-row">
          <div class="crypto-price">${priceDisplay}</div>
          ${changeBadge}
        </div>
        <div style="font-size:0.62rem;color:var(--muted);font-weight:500;margin-bottom:0.2rem">prijs per coin (EUR)</div>
        <div class="crypto-holdings">
          <div>
            <div style="font-size:0.62rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);font-weight:600;margin-bottom:0.3rem">Jouw coins</div>
            <input class="crypto-amount-input"
              type="number" min="0" step="any"
              value="${coin.amount || ''}"
              placeholder="0"
              data-idx="${idx}"
              onchange="updateCryptoAmount(${idx}, this.value)"
            />
          </div>
          <div style="text-align:right">${valueDisplay}</div>
        </div>
      </div>`;
  }).join('');

  updateCryptoTotal();
}

function updateCryptoAmount(idx, val) {
  cryptoCoins[idx].amount = parseFloat(val) || 0;
  saveCryptoDB();
  // Only update the EUR value display, not the whole grid (prevents input losing focus)
  const price = cryptoPriceCache[cryptoCoins[idx].id];
  const eurPrice = price?.eur ?? null;
  const eurValue = (eurPrice !== null && cryptoCoins[idx].amount) ? eurPrice * cryptoCoins[idx].amount : null;
  const card = document.querySelector(`.crypto-amount-input[data-idx="${idx}"]`)?.closest('.crypto-card');
  if (card) {
    const valEl = card.querySelector('.crypto-eur-value');
    const lblEl = card.querySelector('.crypto-eur-label');
    if (valEl) valEl.textContent = eurValue !== null ? fmt(eurValue) : 'â€”';
    if (valEl) valEl.style.color = eurValue !== null ? 'var(--green)' : 'var(--muted)';
    if (lblEl) lblEl.textContent = eurValue !== null ? 'jouw waarde' : 'voer aantal in';
  }
  updateCryptoTotal();
}

function updateCryptoTotal() {
  let total = 0;
  let hasAny = false;
  cryptoCoins.forEach(coin => {
    const price = cryptoPriceCache[coin.id];
    if (price?.eur && coin.amount) {
      total += price.eur * coin.amount;
      hasAny = true;
    }
  });

  const totalEl = document.getElementById('crypto-total-eur');
  const subEl   = document.getElementById('crypto-total-sub');

  if (totalEl) totalEl.textContent = hasAny ? fmt(total) : 'â‚¬ â€”';
  if (subEl) {
    const n = cryptoCoins.filter(c => c.amount > 0).length;
    subEl.textContent = hasAny
      ? `${n} coin${n !== 1 ? 's' : ''} in portefeuille`
      : cryptoCoins.length ? 'Vul je aantal coins in om je waarde te zien' : 'Voeg coins toe om te beginnen';
  }
}

// â”€â”€â”€ ADD / DELETE COIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addCryptoCoin() {
  const name   = document.getElementById('crypto-name').value.trim();
  const coinId = document.getElementById('crypto-id').value.trim().toLowerCase().replace(/\s+/g, '-');
  const symbol = document.getElementById('crypto-symbol').value.trim().toUpperCase();
  const amount = parseFloat(document.getElementById('crypto-amount').value) || 0;

  if (!name)   { toast('âš ï¸ Vul een naam in.'); return; }
  if (!coinId) { toast('âš ï¸ Vul een CoinGecko ID in.'); return; }
  if (!symbol) { toast('âš ï¸ Vul een symbool in (bijv. BTC).'); return; }
  if (cryptoCoins.find(c => c.id === coinId)) { toast('âš ï¸ Deze coin staat er al in.'); return; }

  const colors = ['#4a90e2','#f5a623','#2d7a50','#8a5faf','#e24a4a','#4ae2b0','#e2a84a'];
  const color  = CRYPTO_COLORS[coinId] || colors[cryptoCoins.length % colors.length];

  cryptoCoins.push({ id: coinId, name, symbol, amount, color });
  saveCryptoDB();

  // Clear form
  ['crypto-name','crypto-id','crypto-symbol','crypto-amount'].forEach(id => {
    document.getElementById(id).value = '';
  });

  toast(`â‚¿ ${name} toegevoegd!`);
  loadCryptoPrices();
}

function deleteCryptoCoin(idx) {
  const name = cryptoCoins[idx]?.name || 'Coin';
  cryptoCoins.splice(idx, 1);
  saveCryptoDB();
  renderCryptoPage();
  toast(`ğŸ—‘ ${name} verwijderd.`);
}

// â”€â”€ EXPOSE TO GLOBAL SCOPE (needed for inline onclick handlers with type="module") â”€â”€
Object.assign(window, {
  loginWithGoogle, logoutUser,
  showPage, setType, addTransaction, deleteTransaction,
  addGoal, deleteGoal, updateGoalSaved,
  addAccount, deleteAccount, doTransfer, setOwnerFilter,
  pickAccColor, buildColorPicker,
  addCustomCategory, deleteCustomCategory,
  renderCategoryManager, setCatType,
  updateBudget,
  addCryptoCoin, deleteCryptoCoin, updateCryptoAmount, loadCryptoPrices,
  installApp,
});

</script>

</body>
</html>